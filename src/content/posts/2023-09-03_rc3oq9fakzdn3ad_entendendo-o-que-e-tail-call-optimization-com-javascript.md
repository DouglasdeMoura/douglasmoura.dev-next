---
id: rc3oq9fakzdn3ad
locale: pt-BR
title: "Entendendo o que é Tail Call Optimization com JavaScript"
created: 2023-09-03 02:40:27.535Z
updated: 2023-10-24 15:13:47.577Z
tags: javascript, algorithms, mathematic, Node.js
translates: 8mgwfzzig2t1wd9
---

Considere a seguinte função que calcula o fatorial de um número:

```javascript
const factorial = (n) => {
  let result = 1;

  while (n > 1) {
    result *= n;
    n--;
  }

  return result;
};
```

> [!note] Fatorial
> Em matemática, o fatorial de um inteiro n não negativo (n!), é o produto de todos os inteiros positivos menores ou iguais a n.

A função acima foi implementada de forma iterativa, ou seja, ela utiliza um laço de repetição para calcular o fatorial de um número. Porém, é possível implementar a mesma função de forma recursiva (ou seja: uma função que referencia a si mesma):

```javascript
const factorial = (n) => {
  if (n === 0) return 1;

  return n * factorial(n - 1);
};
```

O resultado de ambas às funções é o mesmo, porém, a função iterativa é [muito mais eficiente](https://jsben.ch/1qyl8) (no JavaScript) que a função recursiva. Além disso, se tentarmos calcular o fatorial de um número muito grande, nós deparamos com o erro RangeError: Maximum call stack size exceeded. Vamos entender o porquê disso e como podemos melhorar a função recursiva.

## Pilha de execução

Uma [pilha de execução (call stack)](https://developer.mozilla.org/en-US/docs/Glossary/Call_stack) é uma estrutura de dados que armazena informações sobre as funções de um programa. Quando uma função é chamada, ela é adicionada à pilha de execução, assim como todas as funções que ela chamar. Quando uma função retorna, ela é removida da pilha de execução. Cada função adicionada à pilha é chamada de _stack frame_.

Para entendermos o que está acontecendo, vamos tentar representar, graficamente, como o cálculo do fatorial de 6 é feito com a função iterativa:

<SVG64 content="PHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCAwIDI2NS45MDYyNSA4MzguNDc2NTYyNSIgc3R5bGU9Im1heC13aWR0aDogMjUwcHg7Ij4KICA8cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iMjY1LjkwNjI1IiBoZWlnaHQ9IjgzOC40NzY1NjI1IiBmaWxsPSIjZmZmZmZmIj48L3JlY3Q+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjMuNDUzMTI1IDIxLjE2MzA4NTkzNzUpIHJvdGF0ZSgwIDgyLjAzMTI1IDM5NikiPjx0ZXh0IHg9IjAiIHk9IjAiIGZvbnQtZmFtaWx5PSJDYXNjYWRpYSwgU2Vnb2UgVUkgRW1vamksIG1vbm9zcGFjZSIgZm9udC1zaXplPSIyMHB4IiBmaWxsPSIjMWUxZTFlIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHN0eWxlPSJ3aGl0ZS1zcGFjZTogcHJlOyIgZGlyZWN0aW9uPSJsdHIiIGRvbWluYW50LWJhc2VsaW5lPSJ0ZXh0LWJlZm9yZS1lZGdlIj5mYWN0b3JpYWwoNik8L3RleHQ+PHRleHQgeD0iMCIgeT0iMjQiIGZvbnQtZmFtaWx5PSJDYXNjYWRpYSwgU2Vnb2UgVUkgRW1vamksIG1vbm9zcGFjZSIgZm9udC1zaXplPSIyMHB4IiBmaWxsPSIjMWUxZTFlIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHN0eWxlPSJ3aGl0ZS1zcGFjZTogcHJlOyIgZGlyZWN0aW9uPSJsdHIiIGRvbWluYW50LWJhc2VsaW5lPSJ0ZXh0LWJlZm9yZS1lZGdlIj48L3RleHQ+PHRleHQgeD0iMCIgeT0iNDgiIGZvbnQtZmFtaWx5PSJDYXNjYWRpYSwgU2Vnb2UgVUkgRW1vamksIG1vbm9zcGFjZSIgZm9udC1zaXplPSIyMHB4IiBmaWxsPSIjMWUxZTFlIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHN0eWxlPSJ3aGl0ZS1zcGFjZTogcHJlOyIgZGlyZWN0aW9uPSJsdHIiIGRvbWluYW50LWJhc2VsaW5lPSJ0ZXh0LWJlZm9yZS1lZGdlIj5yZXN1bHQgPSAxPC90ZXh0Pjx0ZXh0IHg9IjAiIHk9IjcyIiBmb250LWZhbWlseT0iQ2FzY2FkaWEsIFNlZ29lIFVJIEVtb2ppLCBtb25vc3BhY2UiIGZvbnQtc2l6ZT0iMjBweCIgZmlsbD0iIzFlMWUxZSIgdGV4dC1hbmNob3I9InN0YXJ0IiBzdHlsZT0id2hpdGUtc3BhY2U6IHByZTsiIGRpcmVjdGlvbj0ibHRyIiBkb21pbmFudC1iYXNlbGluZT0idGV4dC1iZWZvcmUtZWRnZSI+d2hpbGUoNiAmZ3Q7IDEpIHs8L3RleHQ+PHRleHQgeD0iMCIgeT0iOTYiIGZvbnQtZmFtaWx5PSJDYXNjYWRpYSwgU2Vnb2UgVUkgRW1vamksIG1vbm9zcGFjZSIgZm9udC1zaXplPSIyMHB4IiBmaWxsPSIjMWUxZTFlIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHN0eWxlPSJ3aGl0ZS1zcGFjZTogcHJlOyIgZGlyZWN0aW9uPSJsdHIiIGRvbWluYW50LWJhc2VsaW5lPSJ0ZXh0LWJlZm9yZS1lZGdlIj4gIHJlc3VsdCAqPSA2PC90ZXh0Pjx0ZXh0IHg9IjAiIHk9IjEyMCIgZm9udC1mYW1pbHk9IkNhc2NhZGlhLCBTZWdvZSBVSSBFbW9qaSwgbW9ub3NwYWNlIiBmb250LXNpemU9IjIwcHgiIGZpbGw9IiMxZTFlMWUiIHRleHQtYW5jaG9yPSJzdGFydCIgc3R5bGU9IndoaXRlLXNwYWNlOiBwcmU7IiBkaXJlY3Rpb249Imx0ciIgZG9taW5hbnQtYmFzZWxpbmU9InRleHQtYmVmb3JlLWVkZ2UiPiAgNi0tPC90ZXh0Pjx0ZXh0IHg9IjAiIHk9IjE0NCIgZm9udC1mYW1pbHk9IkNhc2NhZGlhLCBTZWdvZSBVSSBFbW9qaSwgbW9ub3NwYWNlIiBmb250LXNpemU9IjIwcHgiIGZpbGw9IiMxZTFlMWUiIHRleHQtYW5jaG9yPSJzdGFydCIgc3R5bGU9IndoaXRlLXNwYWNlOiBwcmU7IiBkaXJlY3Rpb249Imx0ciIgZG9taW5hbnQtYmFzZWxpbmU9InRleHQtYmVmb3JlLWVkZ2UiPn08L3RleHQ+PHRleHQgeD0iMCIgeT0iMTY4IiBmb250LWZhbWlseT0iQ2FzY2FkaWEsIFNlZ29lIFVJIEVtb2ppLCBtb25vc3BhY2UiIGZvbnQtc2l6ZT0iMjBweCIgZmlsbD0iIzFlMWUxZSIgdGV4dC1hbmNob3I9InN0YXJ0IiBzdHlsZT0id2hpdGUtc3BhY2U6IHByZTsiIGRpcmVjdGlvbj0ibHRyIiBkb21pbmFudC1iYXNlbGluZT0idGV4dC1iZWZvcmUtZWRnZSI+PC90ZXh0Pjx0ZXh0IHg9IjAiIHk9IjE5MiIgZm9udC1mYW1pbHk9IkNhc2NhZGlhLCBTZWdvZSBVSSBFbW9qaSwgbW9ub3NwYWNlIiBmb250LXNpemU9IjIwcHgiIGZpbGw9IiMxZTFlMWUiIHRleHQtYW5jaG9yPSJzdGFydCIgc3R5bGU9IndoaXRlLXNwYWNlOiBwcmU7IiBkaXJlY3Rpb249Imx0ciIgZG9taW5hbnQtYmFzZWxpbmU9InRleHQtYmVmb3JlLWVkZ2UiPnJlc3VsdCA9IDY8L3RleHQ+PHRleHQgeD0iMCIgeT0iMjE2IiBmb250LWZhbWlseT0iQ2FzY2FkaWEsIFNlZ29lIFVJIEVtb2ppLCBtb25vc3BhY2UiIGZvbnQtc2l6ZT0iMjBweCIgZmlsbD0iIzFlMWUxZSIgdGV4dC1hbmNob3I9InN0YXJ0IiBzdHlsZT0id2hpdGUtc3BhY2U6IHByZTsiIGRpcmVjdGlvbj0ibHRyIiBkb21pbmFudC1iYXNlbGluZT0idGV4dC1iZWZvcmUtZWRnZSI+d2hpbGUoNSAmZ3Q7IDEpIHs8L3RleHQ+PHRleHQgeD0iMCIgeT0iMjQwIiBmb250LWZhbWlseT0iQ2FzY2FkaWEsIFNlZ29lIFVJIEVtb2ppLCBtb25vc3BhY2UiIGZvbnQtc2l6ZT0iMjBweCIgZmlsbD0iIzFlMWUxZSIgdGV4dC1hbmNob3I9InN0YXJ0IiBzdHlsZT0id2hpdGUtc3BhY2U6IHByZTsiIGRpcmVjdGlvbj0ibHRyIiBkb21pbmFudC1iYXNlbGluZT0idGV4dC1iZWZvcmUtZWRnZSI+ICByZXN1bHQgKj0gNTwvdGV4dD48dGV4dCB4PSIwIiB5PSIyNjQiIGZvbnQtZmFtaWx5PSJDYXNjYWRpYSwgU2Vnb2UgVUkgRW1vamksIG1vbm9zcGFjZSIgZm9udC1zaXplPSIyMHB4IiBmaWxsPSIjMWUxZTFlIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHN0eWxlPSJ3aGl0ZS1zcGFjZTogcHJlOyIgZGlyZWN0aW9uPSJsdHIiIGRvbWluYW50LWJhc2VsaW5lPSJ0ZXh0LWJlZm9yZS1lZGdlIj4gIDUtLTwvdGV4dD48dGV4dCB4PSIwIiB5PSIyODgiIGZvbnQtZmFtaWx5PSJDYXNjYWRpYSwgU2Vnb2UgVUkgRW1vamksIG1vbm9zcGFjZSIgZm9udC1zaXplPSIyMHB4IiBmaWxsPSIjMWUxZTFlIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHN0eWxlPSJ3aGl0ZS1zcGFjZTogcHJlOyIgZGlyZWN0aW9uPSJsdHIiIGRvbWluYW50LWJhc2VsaW5lPSJ0ZXh0LWJlZm9yZS1lZGdlIj59PC90ZXh0Pjx0ZXh0IHg9IjAiIHk9IjMxMiIgZm9udC1mYW1pbHk9IkNhc2NhZGlhLCBTZWdvZSBVSSBFbW9qaSwgbW9ub3NwYWNlIiBmb250LXNpemU9IjIwcHgiIGZpbGw9IiMxZTFlMWUiIHRleHQtYW5jaG9yPSJzdGFydCIgc3R5bGU9IndoaXRlLXNwYWNlOiBwcmU7IiBkaXJlY3Rpb249Imx0ciIgZG9taW5hbnQtYmFzZWxpbmU9InRleHQtYmVmb3JlLWVkZ2UiPjwvdGV4dD48dGV4dCB4PSIwIiB5PSIzMzYiIGZvbnQtZmFtaWx5PSJDYXNjYWRpYSwgU2Vnb2UgVUkgRW1vamksIG1vbm9zcGFjZSIgZm9udC1zaXplPSIyMHB4IiBmaWxsPSIjMWUxZTFlIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHN0eWxlPSJ3aGl0ZS1zcGFjZTogcHJlOyIgZGlyZWN0aW9uPSJsdHIiIGRvbWluYW50LWJhc2VsaW5lPSJ0ZXh0LWJlZm9yZS1lZGdlIj5yZXN1bHQgPSAzMDwvdGV4dD48dGV4dCB4PSIwIiB5PSIzNjAiIGZvbnQtZmFtaWx5PSJDYXNjYWRpYSwgU2Vnb2UgVUkgRW1vamksIG1vbm9zcGFjZSIgZm9udC1zaXplPSIyMHB4IiBmaWxsPSIjMWUxZTFlIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHN0eWxlPSJ3aGl0ZS1zcGFjZTogcHJlOyIgZGlyZWN0aW9uPSJsdHIiIGRvbWluYW50LWJhc2VsaW5lPSJ0ZXh0LWJlZm9yZS1lZGdlIj53aGlsZSg0ICZndDsgMSkgezwvdGV4dD48dGV4dCB4PSIwIiB5PSIzODQiIGZvbnQtZmFtaWx5PSJDYXNjYWRpYSwgU2Vnb2UgVUkgRW1vamksIG1vbm9zcGFjZSIgZm9udC1zaXplPSIyMHB4IiBmaWxsPSIjMWUxZTFlIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHN0eWxlPSJ3aGl0ZS1zcGFjZTogcHJlOyIgZGlyZWN0aW9uPSJsdHIiIGRvbWluYW50LWJhc2VsaW5lPSJ0ZXh0LWJlZm9yZS1lZGdlIj4gIHJlc3VsdCAqPSA0PC90ZXh0Pjx0ZXh0IHg9IjAiIHk9IjQwOCIgZm9udC1mYW1pbHk9IkNhc2NhZGlhLCBTZWdvZSBVSSBFbW9qaSwgbW9ub3NwYWNlIiBmb250LXNpemU9IjIwcHgiIGZpbGw9IiMxZTFlMWUiIHRleHQtYW5jaG9yPSJzdGFydCIgc3R5bGU9IndoaXRlLXNwYWNlOiBwcmU7IiBkaXJlY3Rpb249Imx0ciIgZG9taW5hbnQtYmFzZWxpbmU9InRleHQtYmVmb3JlLWVkZ2UiPiAgNC0tPC90ZXh0Pjx0ZXh0IHg9IjAiIHk9IjQzMiIgZm9udC1mYW1pbHk9IkNhc2NhZGlhLCBTZWdvZSBVSSBFbW9qaSwgbW9ub3NwYWNlIiBmb250LXNpemU9IjIwcHgiIGZpbGw9IiMxZTFlMWUiIHRleHQtYW5jaG9yPSJzdGFydCIgc3R5bGU9IndoaXRlLXNwYWNlOiBwcmU7IiBkaXJlY3Rpb249Imx0ciIgZG9taW5hbnQtYmFzZWxpbmU9InRleHQtYmVmb3JlLWVkZ2UiPn08L3RleHQ+PHRleHQgeD0iMCIgeT0iNDU2IiBmb250LWZhbWlseT0iQ2FzY2FkaWEsIFNlZ29lIFVJIEVtb2ppLCBtb25vc3BhY2UiIGZvbnQtc2l6ZT0iMjBweCIgZmlsbD0iIzFlMWUxZSIgdGV4dC1hbmNob3I9InN0YXJ0IiBzdHlsZT0id2hpdGUtc3BhY2U6IHByZTsiIGRpcmVjdGlvbj0ibHRyIiBkb21pbmFudC1iYXNlbGluZT0idGV4dC1iZWZvcmUtZWRnZSI+PC90ZXh0Pjx0ZXh0IHg9IjAiIHk9IjQ4MCIgZm9udC1mYW1pbHk9IkNhc2NhZGlhLCBTZWdvZSBVSSBFbW9qaSwgbW9ub3NwYWNlIiBmb250LXNpemU9IjIwcHgiIGZpbGw9IiMxZTFlMWUiIHRleHQtYW5jaG9yPSJzdGFydCIgc3R5bGU9IndoaXRlLXNwYWNlOiBwcmU7IiBkaXJlY3Rpb249Imx0ciIgZG9taW5hbnQtYmFzZWxpbmU9InRleHQtYmVmb3JlLWVkZ2UiPnJlc3VsdCA9IDEyMDwvdGV4dD48dGV4dCB4PSIwIiB5PSI1MDQiIGZvbnQtZmFtaWx5PSJDYXNjYWRpYSwgU2Vnb2UgVUkgRW1vamksIG1vbm9zcGFjZSIgZm9udC1zaXplPSIyMHB4IiBmaWxsPSIjMWUxZTFlIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHN0eWxlPSJ3aGl0ZS1zcGFjZTogcHJlOyIgZGlyZWN0aW9uPSJsdHIiIGRvbWluYW50LWJhc2VsaW5lPSJ0ZXh0LWJlZm9yZS1lZGdlIj53aGlsZSgzICZndDsgMSkgezwvdGV4dD48dGV4dCB4PSIwIiB5PSI1MjgiIGZvbnQtZmFtaWx5PSJDYXNjYWRpYSwgU2Vnb2UgVUkgRW1vamksIG1vbm9zcGFjZSIgZm9udC1zaXplPSIyMHB4IiBmaWxsPSIjMWUxZTFlIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHN0eWxlPSJ3aGl0ZS1zcGFjZTogcHJlOyIgZGlyZWN0aW9uPSJsdHIiIGRvbWluYW50LWJhc2VsaW5lPSJ0ZXh0LWJlZm9yZS1lZGdlIj4gIHJlc3VsdCAqPSAzPC90ZXh0Pjx0ZXh0IHg9IjAiIHk9IjU1MiIgZm9udC1mYW1pbHk9IkNhc2NhZGlhLCBTZWdvZSBVSSBFbW9qaSwgbW9ub3NwYWNlIiBmb250LXNpemU9IjIwcHgiIGZpbGw9IiMxZTFlMWUiIHRleHQtYW5jaG9yPSJzdGFydCIgc3R5bGU9IndoaXRlLXNwYWNlOiBwcmU7IiBkaXJlY3Rpb249Imx0ciIgZG9taW5hbnQtYmFzZWxpbmU9InRleHQtYmVmb3JlLWVkZ2UiPiAgMy0tPC90ZXh0Pjx0ZXh0IHg9IjAiIHk9IjU3NiIgZm9udC1mYW1pbHk9IkNhc2NhZGlhLCBTZWdvZSBVSSBFbW9qaSwgbW9ub3NwYWNlIiBmb250LXNpemU9IjIwcHgiIGZpbGw9IiMxZTFlMWUiIHRleHQtYW5jaG9yPSJzdGFydCIgc3R5bGU9IndoaXRlLXNwYWNlOiBwcmU7IiBkaXJlY3Rpb249Imx0ciIgZG9taW5hbnQtYmFzZWxpbmU9InRleHQtYmVmb3JlLWVkZ2UiPn08L3RleHQ+PHRleHQgeD0iMCIgeT0iNjAwIiBmb250LWZhbWlseT0iQ2FzY2FkaWEsIFNlZ29lIFVJIEVtb2ppLCBtb25vc3BhY2UiIGZvbnQtc2l6ZT0iMjBweCIgZmlsbD0iIzFlMWUxZSIgdGV4dC1hbmNob3I9InN0YXJ0IiBzdHlsZT0id2hpdGUtc3BhY2U6IHByZTsiIGRpcmVjdGlvbj0ibHRyIiBkb21pbmFudC1iYXNlbGluZT0idGV4dC1iZWZvcmUtZWRnZSI+PC90ZXh0Pjx0ZXh0IHg9IjAiIHk9IjYyNCIgZm9udC1mYW1pbHk9IkNhc2NhZGlhLCBTZWdvZSBVSSBFbW9qaSwgbW9ub3NwYWNlIiBmb250LXNpemU9IjIwcHgiIGZpbGw9IiMxZTFlMWUiIHRleHQtYW5jaG9yPSJzdGFydCIgc3R5bGU9IndoaXRlLXNwYWNlOiBwcmU7IiBkaXJlY3Rpb249Imx0ciIgZG9taW5hbnQtYmFzZWxpbmU9InRleHQtYmVmb3JlLWVkZ2UiPnJlc3VsdCA9IDM2MDwvdGV4dD48dGV4dCB4PSIwIiB5PSI2NDgiIGZvbnQtZmFtaWx5PSJDYXNjYWRpYSwgU2Vnb2UgVUkgRW1vamksIG1vbm9zcGFjZSIgZm9udC1zaXplPSIyMHB4IiBmaWxsPSIjMWUxZTFlIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHN0eWxlPSJ3aGl0ZS1zcGFjZTogcHJlOyIgZGlyZWN0aW9uPSJsdHIiIGRvbWluYW50LWJhc2VsaW5lPSJ0ZXh0LWJlZm9yZS1lZGdlIj53aGlsZSgyICZndDsgMSkgezwvdGV4dD48dGV4dCB4PSIwIiB5PSI2NzIiIGZvbnQtZmFtaWx5PSJDYXNjYWRpYSwgU2Vnb2UgVUkgRW1vamksIG1vbm9zcGFjZSIgZm9udC1zaXplPSIyMHB4IiBmaWxsPSIjMWUxZTFlIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHN0eWxlPSJ3aGl0ZS1zcGFjZTogcHJlOyIgZGlyZWN0aW9uPSJsdHIiIGRvbWluYW50LWJhc2VsaW5lPSJ0ZXh0LWJlZm9yZS1lZGdlIj4gIHJlc3VsdCAqPSAyPC90ZXh0Pjx0ZXh0IHg9IjAiIHk9IjY5NiIgZm9udC1mYW1pbHk9IkNhc2NhZGlhLCBTZWdvZSBVSSBFbW9qaSwgbW9ub3NwYWNlIiBmb250LXNpemU9IjIwcHgiIGZpbGw9IiMxZTFlMWUiIHRleHQtYW5jaG9yPSJzdGFydCIgc3R5bGU9IndoaXRlLXNwYWNlOiBwcmU7IiBkaXJlY3Rpb249Imx0ciIgZG9taW5hbnQtYmFzZWxpbmU9InRleHQtYmVmb3JlLWVkZ2UiPiAgMi0tPC90ZXh0Pjx0ZXh0IHg9IjAiIHk9IjcyMCIgZm9udC1mYW1pbHk9IkNhc2NhZGlhLCBTZWdvZSBVSSBFbW9qaSwgbW9ub3NwYWNlIiBmb250LXNpemU9IjIwcHgiIGZpbGw9IiMxZTFlMWUiIHRleHQtYW5jaG9yPSJzdGFydCIgc3R5bGU9IndoaXRlLXNwYWNlOiBwcmU7IiBkaXJlY3Rpb249Imx0ciIgZG9taW5hbnQtYmFzZWxpbmU9InRleHQtYmVmb3JlLWVkZ2UiPn08L3RleHQ+PHRleHQgeD0iMCIgeT0iNzQ0IiBmb250LWZhbWlseT0iQ2FzY2FkaWEsIFNlZ29lIFVJIEVtb2ppLCBtb25vc3BhY2UiIGZvbnQtc2l6ZT0iMjBweCIgZmlsbD0iIzFlMWUxZSIgdGV4dC1hbmNob3I9InN0YXJ0IiBzdHlsZT0id2hpdGUtc3BhY2U6IHByZTsiIGRpcmVjdGlvbj0ibHRyIiBkb21pbmFudC1iYXNlbGluZT0idGV4dC1iZWZvcmUtZWRnZSI+PC90ZXh0Pjx0ZXh0IHg9IjAiIHk9Ijc2OCIgZm9udC1mYW1pbHk9IkNhc2NhZGlhLCBTZWdvZSBVSSBFbW9qaSwgbW9ub3NwYWNlIiBmb250LXNpemU9IjIwcHgiIGZpbGw9IiMxZTFlMWUiIHRleHQtYW5jaG9yPSJzdGFydCIgc3R5bGU9IndoaXRlLXNwYWNlOiBwcmU7IiBkaXJlY3Rpb249Imx0ciIgZG9taW5hbnQtYmFzZWxpbmU9InRleHQtYmVmb3JlLWVkZ2UiPnJlc3VsdCA9IDcyMDwvdGV4dD48L2c+PGcgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMC42MzI4MTI1IDEwKSByb3RhdGUoMCA5MS44Mzc4OTA2MjUgNDA5LjIzODI4MTI1KSI+PHBhdGggZD0iTTAgMCBDNDguNSAwLCA5NyAwLCAxODMuNjggMCBNMCAwIEMzOC4xIDAsIDc2LjIxIDAsIDE4My42OCAwIE0xODMuNjggMCBDMTgzLjY4IDMyMi4zOSwgMTgzLjY4IDY0NC43OCwgMTgzLjY4IDgxOC40OCBNMTgzLjY4IDAgQzE4My42OCAyMDkuMTIsIDE4My42OCA0MTguMjQsIDE4My42OCA4MTguNDggTTE4My42OCA4MTguNDggQzEzNi42NSA4MTguNDgsIDg5LjYzIDgxOC40OCwgMCA4MTguNDggTTE4My42OCA4MTguNDggQzEzOS4yIDgxOC40OCwgOTQuNzIgODE4LjQ4LCAwIDgxOC40OCBNMCA4MTguNDggQzAgNTIwLjM2LCAwIDIyMi4yNSwgMCAwIE0wIDgxOC40OCBDMCA1NTIuOTUsIDAgMjg3LjQxLCAwIDAiIHN0cm9rZT0iIzFlMWUxZSIgc3Ryb2tlLXdpZHRoPSIyIiBmaWxsPSJub25lIj48L3BhdGg+PC9nPjxnIHN0cm9rZS1saW5lY2FwPSJyb3VuZCI+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTAuNDI1NzgxMjUgNTkuMjUpIHJvdGF0ZSgwIDkxLjE1NjI1IC0wLjcxODc1KSI+PHBhdGggZD0iTTAgMCBDNzIuMTIgLTAuNTcsIDE0NC4yNCAtMS4xNCwgMTgyLjMxIC0xLjQ0IE0wIDAgQzcxLjY5IC0wLjU3LCAxNDMuMzkgLTEuMTMsIDE4Mi4zMSAtMS40NCIgc3Ryb2tlPSIjMWUxZTFlIiBzdHJva2Utd2lkdGg9IjIiIGZpbGw9Im5vbmUiPjwvcGF0aD48L2c+PC9nPjxtYXNrPjwvbWFzaz48ZyBzdHJva2UtbGluZWNhcD0icm91bmQiPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDEyLjIzMDQ2ODc1IDIwMi4yNjk1MzEyNSkgcm90YXRlKDAgOTEuMTU2MjUgLTAuNzE4NzUpIj48cGF0aCBkPSJNMCAwIEMzNi41OSAtMC4yOSwgNzMuMTkgLTAuNTgsIDE4Mi4zMSAtMS40NCIgc3Ryb2tlPSIjMWUxZTFlIiBzdHJva2Utd2lkdGg9IjIuNSIgZmlsbD0ibm9uZSIgc3Ryb2tlLWRhc2hhcnJheT0iOCAxMCI+PC9wYXRoPjwvZz48L2c+PG1hc2s+PC9tYXNrPjxnIHN0cm9rZS1saW5lY2FwPSJyb3VuZCI+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTAuNjI1IDM0Ny44NzEwOTM3NSkgcm90YXRlKDAgOTEuMTU2MjUgLTAuNzE4NzUpIj48cGF0aCBkPSJNMCAwIEM1MS4zMyAtMC40LCAxMDIuNjYgLTAuODEsIDE4Mi4zMSAtMS40NCIgc3Ryb2tlPSIjMWUxZTFlIiBzdHJva2Utd2lkdGg9IjIuNSIgZmlsbD0ibm9uZSIgc3Ryb2tlLWRhc2hhcnJheT0iOCAxMCI+PC9wYXRoPjwvZz48L2c+PG1hc2s+PC9tYXNrPjxnIHN0cm9rZS1saW5lY2FwPSJyb3VuZCI+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTEuMDE5NTMxMjUgNDkyLjI4MTI1KSByb3RhdGUoMCA5MS4xNTYyNSAtMC43MTg3NSkiPjxwYXRoIGQ9Ik0wIDAgQzU3LjQ0IC0wLjQ1LCAxMTQuODggLTAuOTEsIDE4Mi4zMSAtMS40NCIgc3Ryb2tlPSIjMWUxZTFlIiBzdHJva2Utd2lkdGg9IjIuNSIgZmlsbD0ibm9uZSIgc3Ryb2tlLWRhc2hhcnJheT0iOCAxMCI+PC9wYXRoPjwvZz48L2c+PG1hc2s+PC9tYXNrPjxnIHN0cm9rZS1saW5lY2FwPSJyb3VuZCI+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTAgNjM4LjczNDM3NSkgcm90YXRlKDAgOTEuMTU2MjUgLTAuNzE4NzUpIj48cGF0aCBkPSJNMCAwIEM2OS43NyAtMC41NSwgMTM5LjU0IC0xLjEsIDE4Mi4zMSAtMS40NCIgc3Ryb2tlPSIjMWUxZTFlIiBzdHJva2Utd2lkdGg9IjIuNSIgZmlsbD0ibm9uZSIgc3Ryb2tlLWRhc2hhcnJheT0iOCAxMCI+PC9wYXRoPjwvZz48L2c+PG1hc2s+PC9tYXNrPjxnIHN0cm9rZS1saW5lY2FwPSJyb3VuZCI+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTAuMzc1IDc3OS4wODU5Mzc1KSByb3RhdGUoMCA5MS43MTY3OTY4NzUgLTAuMTExMzI4MTI1KSI+PHBhdGggZD0iTTAgMCBDNjAuODcgLTAuMDcsIDEyMS43NSAtMC4xNSwgMTgzLjQzIC0wLjIyIE0wIDAgQzQyLjk4IC0wLjA1LCA4NS45NyAtMC4xLCAxODMuNDMgLTAuMjIiIHN0cm9rZT0iIzFlMWUxZSIgc3Ryb2tlLXdpZHRoPSIyIiBmaWxsPSJub25lIj48L3BhdGg+PC9nPjwvZz48bWFzaz48L21hc2s+PGcgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIj48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyNTMuODUxNTYyNSAxOC40NjA5Mzc1KSByb3RhdGUoMCAtMjEuNDg0Mzc1IDM5Mi4yMzgyODEyNSkiPjxwYXRoIGQ9Ik0wIDAgQzAuNTEgMTkzLjgzLCAxLjAyIDM4Ny42NSwgMi4wNSA3ODMuODYgTTAgMCBDMC43NyAyOTUuMzgsIDEuNTUgNTkwLjc2LCAyLjA1IDc4My44NiBNMi4wNSA3ODMuODYgQy0xMy4zNSA3ODQuMDYsIC0yOC43NSA3ODQuMjYsIC00NS4wMiA3ODQuNDggTTIuMDUgNzgzLjg2IEMtOC4xNCA3ODMuOTksIC0xOC4zMyA3ODQuMTIsIC00NS4wMiA3ODQuNDgiIHN0cm9rZT0iI2UwMzEzMSIgc3Ryb2tlLXdpZHRoPSIyIiBmaWxsPSJub25lIj48L3BhdGg+PC9nPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDI1My44NTE1NjI1IDE4LjQ2MDkzNzUpIHJvdGF0ZSgwIC0yMS40ODQzNzUgMzkyLjIzODI4MTI1KSI+PHBhdGggZD0iTS00NS4wMiA3ODQuNDggTC0zMS41MSA3NzcuOTYgTC0zMS4zNSA3OTAuNjQgTC00NS4wMiA3ODQuNDgiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIwIiBmaWxsPSIjZTAzMTMxIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjwvcGF0aD48cGF0aCBkPSJNLTQ1LjAyIDc4NC40OCBDLTQxLjY4IDc4Mi44NiwgLTM4LjM0IDc4MS4yNSwgLTMxLjUxIDc3Ny45NiBNLTQ1LjAyIDc4NC40OCBDLTM5LjkzIDc4Mi4wMiwgLTM0Ljg0IDc3OS41NiwgLTMxLjUxIDc3Ny45NiBNLTMxLjUxIDc3Ny45NiBDLTMxLjQ2IDc4Mi4xMSwgLTMxLjQgNzg2LjI1LCAtMzEuMzUgNzkwLjY0IE0tMzEuNTEgNzc3Ljk2IEMtMzEuNDggNzgwLjcsIC0zMS40NCA3ODMuNDUsIC0zMS4zNSA3OTAuNjQgTS0zMS4zNSA3OTAuNjQgQy0zNC43IDc4OS4xMywgLTM4LjA1IDc4Ny42MiwgLTQ1LjAyIDc4NC40OCBNLTMxLjM1IDc5MC42NCBDLTM1LjUyIDc4OC43NiwgLTM5LjY5IDc4Ni44OCwgLTQ1LjAyIDc4NC40OCBNLTQ1LjAyIDc4NC40OCBDLTQ1LjAyIDc4NC40OCwgLTQ1LjAyIDc4NC40OCwgLTQ1LjAyIDc4NC40OCBNLTQ1LjAyIDc4NC40OCBDLTQ1LjAyIDc4NC40OCwgLTQ1LjAyIDc4NC40OCwgLTQ1LjAyIDc4NC40OCIgc3Ryb2tlPSIjZTAzMTMxIiBzdHJva2Utd2lkdGg9IjIiIGZpbGw9Im5vbmUiPjwvcGF0aD48L2c+PC9nPjxtYXNrPjwvbWFzaz48L3N2Zz4=" />

Agora, compare com o modelo de substituição para o cálculo do fatorial de 6 com a função recursiva:

<SVG64 content="PHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCAwIDUyMy4xMjUwODcxODU1MzM5IDMwOCIgc3R5bGU9Im1heC13aWR0aDogNTAwcHg7Ij4KICA8cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iNTIzLjEyNTA4NzE4NTUzMzkiIGhlaWdodD0iMzA4IiBmaWxsPSIjZmZmZmZmIj48L3JlY3Q+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTAgMTApIHJvdGF0ZSgwIDIzNC4zNzUgMTQ0KSI+PHRleHQgeD0iMCIgeT0iMCIgZm9udC1mYW1pbHk9IkNhc2NhZGlhLCBTZWdvZSBVSSBFbW9qaSxtb25vc3BhY2UiIGZvbnQtc2l6ZT0iMjBweCIgZmlsbD0iIzFlMWUxZSIgdGV4dC1hbmNob3I9InN0YXJ0IiBzdHlsZT0id2hpdGUtc3BhY2U6IHByZTsiIGRpcmVjdGlvbj0ibHRyIiBkb21pbmFudC1iYXNlbGluZT0idGV4dC1iZWZvcmUtZWRnZSI+ZmFjdG9yaWFsKDYpPC90ZXh0Pjx0ZXh0IHg9IjAiIHk9IjI0IiBmb250LWZhbWlseT0iQ2FzY2FkaWEsIFNlZ29lIFVJIEVtb2ppLG1vbm9zcGFjZSIgZm9udC1zaXplPSIyMHB4IiBmaWxsPSIjMWUxZTFlIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHN0eWxlPSJ3aGl0ZS1zcGFjZTogcHJlOyIgZGlyZWN0aW9uPSJsdHIiIGRvbWluYW50LWJhc2VsaW5lPSJ0ZXh0LWJlZm9yZS1lZGdlIj42ICogZmFjdG9yaWFsKDUpPC90ZXh0Pjx0ZXh0IHg9IjAiIHk9IjQ4IiBmb250LWZhbWlseT0iQ2FzY2FkaWEsIFNlZ29lIFVJIEVtb2ppLG1vbm9zcGFjZSIgZm9udC1zaXplPSIyMHB4IiBmaWxsPSIjMWUxZTFlIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHN0eWxlPSJ3aGl0ZS1zcGFjZTogcHJlOyIgZGlyZWN0aW9uPSJsdHIiIGRvbWluYW50LWJhc2VsaW5lPSJ0ZXh0LWJlZm9yZS1lZGdlIj42ICogKDUgKiBmYWN0b3JpYWwoNCkpPC90ZXh0Pjx0ZXh0IHg9IjAiIHk9IjcyIiBmb250LWZhbWlseT0iQ2FzY2FkaWEsIFNlZ29lIFVJIEVtb2ppLG1vbm9zcGFjZSIgZm9udC1zaXplPSIyMHB4IiBmaWxsPSIjMWUxZTFlIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHN0eWxlPSJ3aGl0ZS1zcGFjZTogcHJlOyIgZGlyZWN0aW9uPSJsdHIiIGRvbWluYW50LWJhc2VsaW5lPSJ0ZXh0LWJlZm9yZS1lZGdlIj42ICogKDUgKiAoNCAqIGZhY3RvcmlhbCgzKSkpPC90ZXh0Pjx0ZXh0IHg9IjAiIHk9Ijk2IiBmb250LWZhbWlseT0iQ2FzY2FkaWEsIFNlZ29lIFVJIEVtb2ppLG1vbm9zcGFjZSIgZm9udC1zaXplPSIyMHB4IiBmaWxsPSIjMWUxZTFlIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHN0eWxlPSJ3aGl0ZS1zcGFjZTogcHJlOyIgZGlyZWN0aW9uPSJsdHIiIGRvbWluYW50LWJhc2VsaW5lPSJ0ZXh0LWJlZm9yZS1lZGdlIj42ICogKDUgKiAoNCAqICgzICogZmFjdG9yaWFsKDIpKSkpPC90ZXh0Pjx0ZXh0IHg9IjAiIHk9IjEyMCIgZm9udC1mYW1pbHk9IkNhc2NhZGlhLCBTZWdvZSBVSSBFbW9qaSxtb25vc3BhY2UiIGZvbnQtc2l6ZT0iMjBweCIgZmlsbD0iIzFlMWUxZSIgdGV4dC1hbmNob3I9InN0YXJ0IiBzdHlsZT0id2hpdGUtc3BhY2U6IHByZTsiIGRpcmVjdGlvbj0ibHRyIiBkb21pbmFudC1iYXNlbGluZT0idGV4dC1iZWZvcmUtZWRnZSI+NiAqICg1ICogKDQgKiAoMyAqICgyICogZmFjdG9yaWFsKDEpKSkpKTwvdGV4dD48dGV4dCB4PSIwIiB5PSIxNDQiIGZvbnQtZmFtaWx5PSJDYXNjYWRpYSwgU2Vnb2UgVUkgRW1vamksbW9ub3NwYWNlIiBmb250LXNpemU9IjIwcHgiIGZpbGw9IiMxZTFlMWUiIHRleHQtYW5jaG9yPSJzdGFydCIgc3R5bGU9IndoaXRlLXNwYWNlOiBwcmU7IiBkaXJlY3Rpb249Imx0ciIgZG9taW5hbnQtYmFzZWxpbmU9InRleHQtYmVmb3JlLWVkZ2UiPjYgKiAoNSAqICg0ICogKDMgKiAoMiAqIDEpKSkpPC90ZXh0Pjx0ZXh0IHg9IjAiIHk9IjE2OCIgZm9udC1mYW1pbHk9IkNhc2NhZGlhLCBTZWdvZSBVSSBFbW9qaSxtb25vc3BhY2UiIGZvbnQtc2l6ZT0iMjBweCIgZmlsbD0iIzFlMWUxZSIgdGV4dC1hbmNob3I9InN0YXJ0IiBzdHlsZT0id2hpdGUtc3BhY2U6IHByZTsiIGRpcmVjdGlvbj0ibHRyIiBkb21pbmFudC1iYXNlbGluZT0idGV4dC1iZWZvcmUtZWRnZSI+NiAqICg1ICogKDQgKiAoMyAqIDIpKSk8L3RleHQ+PHRleHQgeD0iMCIgeT0iMTkyIiBmb250LWZhbWlseT0iQ2FzY2FkaWEsIFNlZ29lIFVJIEVtb2ppLG1vbm9zcGFjZSIgZm9udC1zaXplPSIyMHB4IiBmaWxsPSIjMWUxZTFlIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHN0eWxlPSJ3aGl0ZS1zcGFjZTogcHJlOyIgZGlyZWN0aW9uPSJsdHIiIGRvbWluYW50LWJhc2VsaW5lPSJ0ZXh0LWJlZm9yZS1lZGdlIj42ICogKDUgKiAoNCAqIDYpKTwvdGV4dD48dGV4dCB4PSIwIiB5PSIyMTYiIGZvbnQtZmFtaWx5PSJDYXNjYWRpYSwgU2Vnb2UgVUkgRW1vamksbW9ub3NwYWNlIiBmb250LXNpemU9IjIwcHgiIGZpbGw9IiMxZTFlMWUiIHRleHQtYW5jaG9yPSJzdGFydCIgc3R5bGU9IndoaXRlLXNwYWNlOiBwcmU7IiBkaXJlY3Rpb249Imx0ciIgZG9taW5hbnQtYmFzZWxpbmU9InRleHQtYmVmb3JlLWVkZ2UiPjYgKiAoNSAqIDI0KTwvdGV4dD48dGV4dCB4PSIwIiB5PSIyNDAiIGZvbnQtZmFtaWx5PSJDYXNjYWRpYSwgU2Vnb2UgVUkgRW1vamksbW9ub3NwYWNlIiBmb250LXNpemU9IjIwcHgiIGZpbGw9IiMxZTFlMWUiIHRleHQtYW5jaG9yPSJzdGFydCIgc3R5bGU9IndoaXRlLXNwYWNlOiBwcmU7IiBkaXJlY3Rpb249Imx0ciIgZG9taW5hbnQtYmFzZWxpbmU9InRleHQtYmVmb3JlLWVkZ2UiPjYgKiAxMjA8L3RleHQ+PHRleHQgeD0iMCIgeT0iMjY0IiBmb250LWZhbWlseT0iQ2FzY2FkaWEsIFNlZ29lIFVJIEVtb2ppLG1vbm9zcGFjZSIgZm9udC1zaXplPSIyMHB4IiBmaWxsPSIjMWUxZTFlIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHN0eWxlPSJ3aGl0ZS1zcGFjZTogcHJlOyIgZGlyZWN0aW9uPSJsdHIiIGRvbWluYW50LWJhc2VsaW5lPSJ0ZXh0LWJlZm9yZS1lZGdlIj43MjA8L3RleHQ+PC9nPjxnIHN0cm9rZS1saW5lY2FwPSJyb3VuZCI+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTUxLjk5MjE4NzUgMTYuNjgzNTkzNzUpIHJvdGF0ZSgwIDE0Mi4wNzYyMTU0Njc3NjcwNCAxMzMuNDkwMjM0Mzc1KSI+PHBhdGggZD0iTTAgMCBDNjAuMTMgMjAuOTMsIDM3My41OCA4MS4wNywgMzYwLjc1IDEyNS41NyBDMzQ3LjkyIDE3MC4wNiwgLTQuMDMgMjQzLjQxLCAtNzYuOTggMjY2Ljk4IE0wIDAgQzYwLjEzIDIwLjkzLCAzNzMuNTggODEuMDcsIDM2MC43NSAxMjUuNTcgQzM0Ny45MiAxNzAuMDYsIC00LjAzIDI0My40MSwgLTc2Ljk4IDI2Ni45OCIgc3Ryb2tlPSIjZTAzMTMxIiBzdHJva2Utd2lkdGg9IjIiIGZpbGw9Im5vbmUiPjwvcGF0aD48L2c+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTUxLjk5MjE4NzUgMTYuNjgzNTkzNzUpIHJvdGF0ZSgwIDE0Mi4wNzYyMTU0Njc3NjcwNCAxMzMuNDkwMjM0Mzc1KSI+PHBhdGggZD0iTS03Ni45OCAyNjYuOTggTC02NS40MyAyNTcuNDEgTC02Mi4yMiAyNjkuNjcgTC03Ni45OCAyNjYuOTgiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIwIiBmaWxsPSIjZTAzMTMxIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjwvcGF0aD48cGF0aCBkPSJNLTc2Ljk4IDI2Ni45OCBDLTc0LjEyIDI2NC42MSwgLTcxLjI3IDI2Mi4yNCwgLTY1LjQzIDI1Ny40MSBNLTc2Ljk4IDI2Ni45OCBDLTczLjk1IDI2NC40NywgLTcwLjkyIDI2MS45NiwgLTY1LjQzIDI1Ny40MSBNLTY1LjQzIDI1Ny40MSBDLTY0LjcgMjYwLjIsIC02My45NyAyNjMsIC02Mi4yMiAyNjkuNjcgTS02NS40MyAyNTcuNDEgQy02NC41OCAyNjAuNjcsIC02My43MyAyNjMuOTMsIC02Mi4yMiAyNjkuNjcgTS02Mi4yMiAyNjkuNjcgQy02Ny41NCAyNjguNywgLTcyLjg1IDI2Ny43MywgLTc2Ljk4IDI2Ni45OCBNLTYyLjIyIDI2OS42NyBDLTY3LjkzIDI2OC42MywgLTczLjYzIDI2Ny41OSwgLTc2Ljk4IDI2Ni45OCBNLTc2Ljk4IDI2Ni45OCBDLTc2Ljk4IDI2Ni45OCwgLTc2Ljk4IDI2Ni45OCwgLTc2Ljk4IDI2Ni45OCBNLTc2Ljk4IDI2Ni45OCBDLTc2Ljk4IDI2Ni45OCwgLTc2Ljk4IDI2Ni45OCwgLTc2Ljk4IDI2Ni45OCIgc3Ryb2tlPSIjZTAzMTMxIiBzdHJva2Utd2lkdGg9IjIiIGZpbGw9Im5vbmUiPjwvcGF0aD48L2c+PC9nPjxtYXNrPjwvbWFzaz48L3N2Zz4=" />

Observe, que, na função iterativa, a forma da seta é linear e podemos ver o estado de cada variável em cada passo. Além disso, a cada iteração do nosso laço de repetição, um cálculo e efetuado e as variáveis armazenadas na memória são atualizadas. Na função recursiva, a forma da seta é exponencial e não podemos ver o estado de todas as variáveis na primeira metade do processamento. Além disso, a cada vez que a função é executada, mais memória precisa ser utilizada para armazenar os valores resultantes de cada execução.

Mas, o que isso significa? Para que o JavaScript possa calcular o fatorial de 6, com a função iterativa, a condição `while` é adicionada à pilha, onde seu cálculo é efetuado, a variável result é atualizada e, em seguida, o bloco de código executado do `while` é retirado da pilha. Isso é feito até que a condição while seja falsa, ou seja, até que o valor de `n` seja menor ou igual a 1.

Já, na função recursiva, cada chamada da função `factorial` é adicionada à pilha quantas vezes forem necessárias até que a condição if seja falsa, ou seja, até que o valor de `n` seja menor ou igual a 1. Isso significa que, para calcular o fatorial de 6, a função factorial é adicionada à pilha 6 vezes, para, então ser executada. E é por isso que, quando tentamos calcular o fatorial de um número grande (100.000, por exemplo), nos deparamos com o erro `RangeError: Maximum call stack size exceeded`: não há espaço suficiente na pilha para armazenar todas as chamadas da função factorial.

## Introduzindo Tail Call Optimization

Como bem definido pelo [Dr. Axel Rauschmayer](https://dr-axel.de/) (grifo meu):

> [...] sempre que a última coisa que uma função faz é chamar outra função, então esta última não precisa retornar para sua chamadora. Como consequência, nenhuma informação precisa ser armazenada na pilha de chamadas e a chamada de função é mais como um goto (um salto). Esse tipo de chamada é chamado de _tail call_; não aumentar a pilha é chamado de tail call optmization (TCO).

Ora, descobrimos que nossa função para calcular fatorial não é _tail recursive_. Mas, como podemos torná-la tail recursiva? Com a ajuda de outra função:

```javascript
const factorial = (n) => {
  return factorialHelper(n, 1);
};

const factorialHelper = (x, accumulator) => {
  if (x <= 1) {
    return accumulator;
  }

  return factorialHelper(x - 1, x * accumulator);
};
```

Agora, sim, nossa função é _tail recursive_: a última coisa que ela faz é chamar uma função (e não calcular uma expressão, como na primeira implementação).Agora, vamos ver o modelo de substituição para o cálculo do fatorial de 6 com a nossa nova função `factorial`:

<SVG64 content="PHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCAwIDMyMS4zMTY0MDYyNSAyMjguNDIxODc1IiBzdHlsZT0ibWF4LXdpZHRoOiAzMDBweDsiPgogIDxyZWN0IHg9IjAiIHk9IjAiIHdpZHRoPSIzMjEuMzE2NDA2MjUiIGhlaWdodD0iMjI4LjQyMTg3NSIgZmlsbD0iI2ZmZmZmZiI+PC9yZWN0PjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDEwIDI2LjQyMTg3NSkgcm90YXRlKDAgMTM0Ljc2NTYyNSA5NikiPjx0ZXh0IHg9IjAiIHk9IjAiIGZvbnQtZmFtaWx5PSJDYXNjYWRpYSwgU2Vnb2UgVUkgRW1vamksIG1vbm9zcGFjZSIgZm9udC1zaXplPSIyMHB4IiBmaWxsPSIjMWUxZTFlIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHN0eWxlPSJ3aGl0ZS1zcGFjZTogcHJlOyIgZGlyZWN0aW9uPSJsdHIiIGRvbWluYW50LWJhc2VsaW5lPSJ0ZXh0LWJlZm9yZS1lZGdlIj5mYWN0b3JpYWwoNik8L3RleHQ+PHRleHQgeD0iMCIgeT0iMjQiIGZvbnQtZmFtaWx5PSJDYXNjYWRpYSwgU2Vnb2UgVUkgRW1vamksIG1vbm9zcGFjZSIgZm9udC1zaXplPSIyMHB4IiBmaWxsPSIjMWUxZTFlIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHN0eWxlPSJ3aGl0ZS1zcGFjZTogcHJlOyIgZGlyZWN0aW9uPSJsdHIiIGRvbWluYW50LWJhc2VsaW5lPSJ0ZXh0LWJlZm9yZS1lZGdlIj5mYWN0b3JpYWxIZWxwZXIoNiwgMSk8L3RleHQ+PHRleHQgeD0iMCIgeT0iNDgiIGZvbnQtZmFtaWx5PSJDYXNjYWRpYSwgU2Vnb2UgVUkgRW1vamksIG1vbm9zcGFjZSIgZm9udC1zaXplPSIyMHB4IiBmaWxsPSIjMWUxZTFlIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHN0eWxlPSJ3aGl0ZS1zcGFjZTogcHJlOyIgZGlyZWN0aW9uPSJsdHIiIGRvbWluYW50LWJhc2VsaW5lPSJ0ZXh0LWJlZm9yZS1lZGdlIj5mYWN0b3JpYWxIZWxwZXIoNSwgNik8L3RleHQ+PHRleHQgeD0iMCIgeT0iNzIiIGZvbnQtZmFtaWx5PSJDYXNjYWRpYSwgU2Vnb2UgVUkgRW1vamksIG1vbm9zcGFjZSIgZm9udC1zaXplPSIyMHB4IiBmaWxsPSIjMWUxZTFlIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHN0eWxlPSJ3aGl0ZS1zcGFjZTogcHJlOyIgZGlyZWN0aW9uPSJsdHIiIGRvbWluYW50LWJhc2VsaW5lPSJ0ZXh0LWJlZm9yZS1lZGdlIj5mYWN0b3JpYWxIZWxwZXIoNCwgMzApPC90ZXh0Pjx0ZXh0IHg9IjAiIHk9Ijk2IiBmb250LWZhbWlseT0iQ2FzY2FkaWEsIFNlZ29lIFVJIEVtb2ppLCBtb25vc3BhY2UiIGZvbnQtc2l6ZT0iMjBweCIgZmlsbD0iIzFlMWUxZSIgdGV4dC1hbmNob3I9InN0YXJ0IiBzdHlsZT0id2hpdGUtc3BhY2U6IHByZTsiIGRpcmVjdGlvbj0ibHRyIiBkb21pbmFudC1iYXNlbGluZT0idGV4dC1iZWZvcmUtZWRnZSI+ZmFjdG9yaWFsSGVscGVyKDMsIDEyMCk8L3RleHQ+PHRleHQgeD0iMCIgeT0iMTIwIiBmb250LWZhbWlseT0iQ2FzY2FkaWEsIFNlZ29lIFVJIEVtb2ppLCBtb25vc3BhY2UiIGZvbnQtc2l6ZT0iMjBweCIgZmlsbD0iIzFlMWUxZSIgdGV4dC1hbmNob3I9InN0YXJ0IiBzdHlsZT0id2hpdGUtc3BhY2U6IHByZTsiIGRpcmVjdGlvbj0ibHRyIiBkb21pbmFudC1iYXNlbGluZT0idGV4dC1iZWZvcmUtZWRnZSI+ZmFjdG9yaWFsSGVscGVyKDIsIDM2MCk8L3RleHQ+PHRleHQgeD0iMCIgeT0iMTQ0IiBmb250LWZhbWlseT0iQ2FzY2FkaWEsIFNlZ29lIFVJIEVtb2ppLCBtb25vc3BhY2UiIGZvbnQtc2l6ZT0iMjBweCIgZmlsbD0iIzFlMWUxZSIgdGV4dC1hbmNob3I9InN0YXJ0IiBzdHlsZT0id2hpdGUtc3BhY2U6IHByZTsiIGRpcmVjdGlvbj0ibHRyIiBkb21pbmFudC1iYXNlbGluZT0idGV4dC1iZWZvcmUtZWRnZSI+ZmFjdG9yaWFsSGVscGVyKDEsIDcyMCk8L3RleHQ+PHRleHQgeD0iMCIgeT0iMTY4IiBmb250LWZhbWlseT0iQ2FzY2FkaWEsIFNlZ29lIFVJIEVtb2ppLCBtb25vc3BhY2UiIGZvbnQtc2l6ZT0iMjBweCIgZmlsbD0iIzFlMWUxZSIgdGV4dC1hbmNob3I9InN0YXJ0IiBzdHlsZT0id2hpdGUtc3BhY2U6IHByZTsiIGRpcmVjdGlvbj0ibHRyIiBkb21pbmFudC1iYXNlbGluZT0idGV4dC1iZWZvcmUtZWRnZSI+NzIwPC90ZXh0PjwvZz48ZyBzdHJva2UtbGluZWNhcD0icm91bmQiPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDMxOS45MTAxNTYyNSAxMCkgcm90YXRlKDAgLTI0LjQxMDE1NjI1IDk5LjY2NDA2MjUpIj48cGF0aCBkPSJNLTguNTkgMCBDLTguNzcgNzcuNzUsIC04Ljk1IDE1NS41MSwgLTkuMDUgMTk5LjMzIE0tOC41OSAwIEMtOC43MiA1Ny4xMSwgLTguODYgMTE0LjIyLCAtOS4wNSAxOTkuMzMgTS05LjA1IDE5OS4zMyBDLTE3LjI0IDE5OS4yMiwgLTI1LjQ0IDE5OS4xMSwgLTQwLjIzIDE5OC45MSBNLTkuMDUgMTk5LjMzIEMtMjAuOTYgMTk5LjE3LCAtMzIuODcgMTk5LjAxLCAtNDAuMjMgMTk4LjkxIiBzdHJva2U9IiNlMDMxMzEiIHN0cm9rZS13aWR0aD0iMiIgZmlsbD0ibm9uZSI+PC9wYXRoPjwvZz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgzMTkuOTEwMTU2MjUgMTApIHJvdGF0ZSgwIC0yNC40MTAxNTYyNSA5OS42NjQwNjI1KSI+PHBhdGggZD0iTS00MC4yMyAxOTguOTEgTC0yNi41NSAxOTIuNzUgTC0yNi43MiAyMDUuNDMgTC00MC4yMyAxOTguOTEiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIwIiBmaWxsPSIjZTAzMTMxIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjwvcGF0aD48cGF0aCBkPSJNLTQwLjIzIDE5OC45MSBDLTM0Ljg5IDE5Ni41MSwgLTI5LjU2IDE5NC4xMSwgLTI2LjU1IDE5Mi43NSBNLTQwLjIzIDE5OC45MSBDLTM2LjMxIDE5Ny4xNSwgLTMyLjM5IDE5NS4zOCwgLTI2LjU1IDE5Mi43NSBNLTI2LjU1IDE5Mi43NSBDLTI2LjU5IDE5Ni4wOSwgLTI2LjY0IDE5OS40MiwgLTI2LjcyIDIwNS40MyBNLTI2LjU1IDE5Mi43NSBDLTI2LjYxIDE5Ny42LCAtMjYuNjggMjAyLjQ0LCAtMjYuNzIgMjA1LjQzIE0tMjYuNzIgMjA1LjQzIEMtMjkuNSAyMDQuMDksIC0zMi4yNyAyMDIuNzUsIC00MC4yMyAxOTguOTEgTS0yNi43MiAyMDUuNDMgQy0zMC4yNyAyMDMuNzIsIC0zMy44MSAyMDIuMDEsIC00MC4yMyAxOTguOTEgTS00MC4yMyAxOTguOTEgQy00MC4yMyAxOTguOTEsIC00MC4yMyAxOTguOTEsIC00MC4yMyAxOTguOTEgTS00MC4yMyAxOTguOTEgQy00MC4yMyAxOTguOTEsIC00MC4yMyAxOTguOTEsIC00MC4yMyAxOTguOTEiIHN0cm9rZT0iI2UwMzEzMSIgc3Ryb2tlLXdpZHRoPSIyIiBmaWxsPSJub25lIj48L3BhdGg+PC9nPjwvZz48bWFzaz48L21hc2s+PC9zdmc+" />

[O desempenho é superior](https://jsben.ch/vOf9P) ao da nossa primeira implementação, apesar de ainda não bater o desempenho da função iterativa. Porém, ainda nos deparamos com o erro `RangeError: Maximum call stack size exceeded`. Mas, por que isso acontece? Porque, apesar de nossa função ser _tail recursive_, as atuais versões do Node.js e os navegadores ([com exceção do Safari](https://webkit.org/blog/6240/ecmascript-6-proper-tail-calls-in-webkit/)) não implementa Tail Call Optimization (apesar de sua inclusão na especificação do [EcmaScript](https://262.ecma-international.org/6.0/#sec-tail-position-calls) desde 2015).

Mas, como resolveremos este problema? Com a ajuda de outra função, claro! Para isso, vamos contar com a ajuda do padrão [Trampoline](<https://en.wikipedia.org/wiki/Trampoline_(computing)>):

```javascript
const trampoline = (fn) => {
  while (typeof fn === "function") {
    fn = fn();
  }

  return result;
};
```

Nossas função trampoline consiste em um laço de repetição que invoca uma função que envolve outra função (o que chamamos de [thunk](https://en.wikipedia.org/wiki/Thunk)) até que não haja mais funções para executar. Vamos ver como ficaria a implementação da nossa função factorial com o padrão Trampoline:

```javascript
const trampoline = (fn) => {
  while (typeof fn === "function") {
    fn = fn();
  }

  return fn;
};

const factorialHelper = (x, accumulator) => {
  if (x <= 1) {
    return accumulator;
  }

  // Note que, agora, a função retorna uma função
  return () => factorialHelper(x - 1, x * accumulator);
};

const factorial = (n) => {
  return trampoline(factorialHelper(n, 1));
};
```

E agora sim, podemos chamar a nossa função factorial com um número grande, sem nos depararmos com o erro RangeError: Maximum call stack size exceeded. Claro, dependendo do fatorial que quisermos calcular, nos depararemos com um Infinity, por se tratar de um número muito grande (um número maior que o Number.MAX_SAFE_INTEGER: 253 - <sup>1</sup>). Neste caso, podemos usar o [BigInt](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/BigInt):

```javascript
const trampoline = (fn) => {
  while (typeof fn === "function") {
    fn = fn();
  }

  return fn;
};

const factorialHelper = (x, accumulator) => {
  if (x <= 1) {
    return accumulator;
  }

  return () => factorialHelper(x - 1n, x * accumulator);
};

const factorial = (n) => {
  // Convertendo os valores para BigInt
  //-------------------------------\/----------\/
  return trampoline(factorialHelper(BigInt(n), 1n));
};
```

## Tipando a nossa função

E, para finalizar, vamos adicionar os tipos necessários para a nossa função factorial:

```typescript
type Thunk = bigint | (() => Thunk);

const trampoline = (fn: Thunk) => {
  while (typeof fn === "function") {
    fn = fn();
  }

  return fn;
};

const factorialHelper = (x: bigint, accumulator: bigint): Thunk => {
  if (x <= 1) {
    return accumulator;
  }

  return () => factorialHelper(x - 1n, x * accumulator);
};

const factorial = (n: number) => {
  return trampoline(factorialHelper(BigInt(n), 1n));
};
```

## Referências

- [What happened to proper tail calls in JavaScript?](https://www.mgmarlow.com/words/2021-03-27-proper-tail-calls-js/)
- [Tail Call Optmization](https://exploringjs.com/es6/ch_tail-calls.html)
- [Limites da recursão em JavaScript, TCO e o pattern Trampoline](http://cangaceirojavascript.com.br/limites-recursao-javascript-tco-e-pattern-trampoline/)
- [What is an Activation object in JavaScript?](https://softwareengineering.stackexchange.com/a/189973/383960)
- [Factorial](https://mathworld.wolfram.com/Factorial.html)
- [Tail Recursion Explained - Computerphile](https://www.youtube.com/watch?v=_JtPhF8MshA)
- [Tail Call Optimization: The Musical!!](https://www.youtube.com/watch?v=-PX0BV9hGZY)
