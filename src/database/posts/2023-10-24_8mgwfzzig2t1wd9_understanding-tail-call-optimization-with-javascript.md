---
id: 8mgwfzzig2t1wd9
locale: en-US
title: 'Understanding Tail Call Optimization With JavaScript'
created: 2023-10-24 15:13:38.216Z
updated: 2023-10-24 15:27:40.960Z
tags: algorithms, javascript, mathematic, Node.js
translates: rc3oq9fakzdn3ad
---
Consider the following function that calculates the factorial of a number:

```javascript
const factorial = (n) => {
  let result = 1

  while (n > 1) {
    result *= n
    n--
  }

  return result
}
```
<Alert title="Factorial" mb="md" color="blue">
In Mathematics, the factorial of a non-negative integer (n!) is the product of all positive integers less than or equal to n.
</Alert>

The function above was implemented iteratively, that is, it uses a loop to calculate the factorial of a number. However, it is possible to implement the same function recursively (that is, a function that references itself):

```javascript
const factorial = (n) => {
  if (n === 0) return 1

  return n * factorial(n - 1)
}
```

The result of both functions is the same, however, the iterative function is [much more efficient](https://jsben.ch/1qyl8) (in JavaScript) than the recursive function. In addition, if we try to calculate the factorial of a very large number, we encounter the error RangeError: Maximum call stack size exceeded. Let's understand why this happens and how we can improve the recursive function.

## Call Stack

A [call stack](https://developer.mozilla.org/en-US/docs/Glossary/Call_stack) is a data structure that stores information about a program's functions. When a function is called, it is added to the execution stack, as well as all the functions it calls. When a function returns, it is removed from the execution stack. Each function added to the stack is called a _stack frame_.

In order to understand what is happening, let's try to represent, graphically, how the calculation of the factorial of 6 is done with the iterative function:

<SVG64 content="PHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCAwIDI2NS45MDYyNSA4MzguNDc2NTYyNSIgc3R5bGU9Im1heC13aWR0aDogMjUwcHg7Ij4KICA8cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iMjY1LjkwNjI1IiBoZWlnaHQ9IjgzOC40NzY1NjI1IiBmaWxsPSIjZmZmZmZmIj48L3JlY3Q+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjMuNDUzMTI1IDIxLjE2MzA4NTkzNzUpIHJvdGF0ZSgwIDgyLjAzMTI1IDM5NikiPjx0ZXh0IHg9IjAiIHk9IjAiIGZvbnQtZmFtaWx5PSJDYXNjYWRpYSwgU2Vnb2UgVUkgRW1vamksIG1vbm9zcGFjZSIgZm9udC1zaXplPSIyMHB4IiBmaWxsPSIjMWUxZTFlIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHN0eWxlPSJ3aGl0ZS1zcGFjZTogcHJlOyIgZGlyZWN0aW9uPSJsdHIiIGRvbWluYW50LWJhc2VsaW5lPSJ0ZXh0LWJlZm9yZS1lZGdlIj5mYWN0b3JpYWwoNik8L3RleHQ+PHRleHQgeD0iMCIgeT0iMjQiIGZvbnQtZmFtaWx5PSJDYXNjYWRpYSwgU2Vnb2UgVUkgRW1vamksIG1vbm9zcGFjZSIgZm9udC1zaXplPSIyMHB4IiBmaWxsPSIjMWUxZTFlIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHN0eWxlPSJ3aGl0ZS1zcGFjZTogcHJlOyIgZGlyZWN0aW9uPSJsdHIiIGRvbWluYW50LWJhc2VsaW5lPSJ0ZXh0LWJlZm9yZS1lZGdlIj48L3RleHQ+PHRleHQgeD0iMCIgeT0iNDgiIGZvbnQtZmFtaWx5PSJDYXNjYWRpYSwgU2Vnb2UgVUkgRW1vamksIG1vbm9zcGFjZSIgZm9udC1zaXplPSIyMHB4IiBmaWxsPSIjMWUxZTFlIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHN0eWxlPSJ3aGl0ZS1zcGFjZTogcHJlOyIgZGlyZWN0aW9uPSJsdHIiIGRvbWluYW50LWJhc2VsaW5lPSJ0ZXh0LWJlZm9yZS1lZGdlIj5yZXN1bHQgPSAxPC90ZXh0Pjx0ZXh0IHg9IjAiIHk9IjcyIiBmb250LWZhbWlseT0iQ2FzY2FkaWEsIFNlZ29lIFVJIEVtb2ppLCBtb25vc3BhY2UiIGZvbnQtc2l6ZT0iMjBweCIgZmlsbD0iIzFlMWUxZSIgdGV4dC1hbmNob3I9InN0YXJ0IiBzdHlsZT0id2hpdGUtc3BhY2U6IHByZTsiIGRpcmVjdGlvbj0ibHRyIiBkb21pbmFudC1iYXNlbGluZT0idGV4dC1iZWZvcmUtZWRnZSI+d2hpbGUoNiAmZ3Q7IDEpIHs8L3RleHQ+PHRleHQgeD0iMCIgeT0iOTYiIGZvbnQtZmFtaWx5PSJDYXNjYWRpYSwgU2Vnb2UgVUkgRW1vamksIG1vbm9zcGFjZSIgZm9udC1zaXplPSIyMHB4IiBmaWxsPSIjMWUxZTFlIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHN0eWxlPSJ3aGl0ZS1zcGFjZTogcHJlOyIgZGlyZWN0aW9uPSJsdHIiIGRvbWluYW50LWJhc2VsaW5lPSJ0ZXh0LWJlZm9yZS1lZGdlIj4gIHJlc3VsdCAqPSA2PC90ZXh0Pjx0ZXh0IHg9IjAiIHk9IjEyMCIgZm9udC1mYW1pbHk9IkNhc2NhZGlhLCBTZWdvZSBVSSBFbW9qaSwgbW9ub3NwYWNlIiBmb250LXNpemU9IjIwcHgiIGZpbGw9IiMxZTFlMWUiIHRleHQtYW5jaG9yPSJzdGFydCIgc3R5bGU9IndoaXRlLXNwYWNlOiBwcmU7IiBkaXJlY3Rpb249Imx0ciIgZG9taW5hbnQtYmFzZWxpbmU9InRleHQtYmVmb3JlLWVkZ2UiPiAgNi0tPC90ZXh0Pjx0ZXh0IHg9IjAiIHk9IjE0NCIgZm9udC1mYW1pbHk9IkNhc2NhZGlhLCBTZWdvZSBVSSBFbW9qaSwgbW9ub3NwYWNlIiBmb250LXNpemU9IjIwcHgiIGZpbGw9IiMxZTFlMWUiIHRleHQtYW5jaG9yPSJzdGFydCIgc3R5bGU9IndoaXRlLXNwYWNlOiBwcmU7IiBkaXJlY3Rpb249Imx0ciIgZG9taW5hbnQtYmFzZWxpbmU9InRleHQtYmVmb3JlLWVkZ2UiPn08L3RleHQ+PHRleHQgeD0iMCIgeT0iMTY4IiBmb250LWZhbWlseT0iQ2FzY2FkaWEsIFNlZ29lIFVJIEVtb2ppLCBtb25vc3BhY2UiIGZvbnQtc2l6ZT0iMjBweCIgZmlsbD0iIzFlMWUxZSIgdGV4dC1hbmNob3I9InN0YXJ0IiBzdHlsZT0id2hpdGUtc3BhY2U6IHByZTsiIGRpcmVjdGlvbj0ibHRyIiBkb21pbmFudC1iYXNlbGluZT0idGV4dC1iZWZvcmUtZWRnZSI+PC90ZXh0Pjx0ZXh0IHg9IjAiIHk9IjE5MiIgZm9udC1mYW1pbHk9IkNhc2NhZGlhLCBTZWdvZSBVSSBFbW9qaSwgbW9ub3NwYWNlIiBmb250LXNpemU9IjIwcHgiIGZpbGw9IiMxZTFlMWUiIHRleHQtYW5jaG9yPSJzdGFydCIgc3R5bGU9IndoaXRlLXNwYWNlOiBwcmU7IiBkaXJlY3Rpb249Imx0ciIgZG9taW5hbnQtYmFzZWxpbmU9InRleHQtYmVmb3JlLWVkZ2UiPnJlc3VsdCA9IDY8L3RleHQ+PHRleHQgeD0iMCIgeT0iMjE2IiBmb250LWZhbWlseT0iQ2FzY2FkaWEsIFNlZ29lIFVJIEVtb2ppLCBtb25vc3BhY2UiIGZvbnQtc2l6ZT0iMjBweCIgZmlsbD0iIzFlMWUxZSIgdGV4dC1hbmNob3I9InN0YXJ0IiBzdHlsZT0id2hpdGUtc3BhY2U6IHByZTsiIGRpcmVjdGlvbj0ibHRyIiBkb21pbmFudC1iYXNlbGluZT0idGV4dC1iZWZvcmUtZWRnZSI+d2hpbGUoNSAmZ3Q7IDEpIHs8L3RleHQ+PHRleHQgeD0iMCIgeT0iMjQwIiBmb250LWZhbWlseT0iQ2FzY2FkaWEsIFNlZ29lIFVJIEVtb2ppLCBtb25vc3BhY2UiIGZvbnQtc2l6ZT0iMjBweCIgZmlsbD0iIzFlMWUxZSIgdGV4dC1hbmNob3I9InN0YXJ0IiBzdHlsZT0id2hpdGUtc3BhY2U6IHByZTsiIGRpcmVjdGlvbj0ibHRyIiBkb21pbmFudC1iYXNlbGluZT0idGV4dC1iZWZvcmUtZWRnZSI+ICByZXN1bHQgKj0gNTwvdGV4dD48dGV4dCB4PSIwIiB5PSIyNjQiIGZvbnQtZmFtaWx5PSJDYXNjYWRpYSwgU2Vnb2UgVUkgRW1vamksIG1vbm9zcGFjZSIgZm9udC1zaXplPSIyMHB4IiBmaWxsPSIjMWUxZTFlIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHN0eWxlPSJ3aGl0ZS1zcGFjZTogcHJlOyIgZGlyZWN0aW9uPSJsdHIiIGRvbWluYW50LWJhc2VsaW5lPSJ0ZXh0LWJlZm9yZS1lZGdlIj4gIDUtLTwvdGV4dD48dGV4dCB4PSIwIiB5PSIyODgiIGZvbnQtZmFtaWx5PSJDYXNjYWRpYSwgU2Vnb2UgVUkgRW1vamksIG1vbm9zcGFjZSIgZm9udC1zaXplPSIyMHB4IiBmaWxsPSIjMWUxZTFlIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHN0eWxlPSJ3aGl0ZS1zcGFjZTogcHJlOyIgZGlyZWN0aW9uPSJsdHIiIGRvbWluYW50LWJhc2VsaW5lPSJ0ZXh0LWJlZm9yZS1lZGdlIj59PC90ZXh0Pjx0ZXh0IHg9IjAiIHk9IjMxMiIgZm9udC1mYW1pbHk9IkNhc2NhZGlhLCBTZWdvZSBVSSBFbW9qaSwgbW9ub3NwYWNlIiBmb250LXNpemU9IjIwcHgiIGZpbGw9IiMxZTFlMWUiIHRleHQtYW5jaG9yPSJzdGFydCIgc3R5bGU9IndoaXRlLXNwYWNlOiBwcmU7IiBkaXJlY3Rpb249Imx0ciIgZG9taW5hbnQtYmFzZWxpbmU9InRleHQtYmVmb3JlLWVkZ2UiPjwvdGV4dD48dGV4dCB4PSIwIiB5PSIzMzYiIGZvbnQtZmFtaWx5PSJDYXNjYWRpYSwgU2Vnb2UgVUkgRW1vamksIG1vbm9zcGFjZSIgZm9udC1zaXplPSIyMHB4IiBmaWxsPSIjMWUxZTFlIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHN0eWxlPSJ3aGl0ZS1zcGFjZTogcHJlOyIgZGlyZWN0aW9uPSJsdHIiIGRvbWluYW50LWJhc2VsaW5lPSJ0ZXh0LWJlZm9yZS1lZGdlIj5yZXN1bHQgPSAzMDwvdGV4dD48dGV4dCB4PSIwIiB5PSIzNjAiIGZvbnQtZmFtaWx5PSJDYXNjYWRpYSwgU2Vnb2UgVUkgRW1vamksIG1vbm9zcGFjZSIgZm9udC1zaXplPSIyMHB4IiBmaWxsPSIjMWUxZTFlIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHN0eWxlPSJ3aGl0ZS1zcGFjZTogcHJlOyIgZGlyZWN0aW9uPSJsdHIiIGRvbWluYW50LWJhc2VsaW5lPSJ0ZXh0LWJlZm9yZS1lZGdlIj53aGlsZSg0ICZndDsgMSkgezwvdGV4dD48dGV4dCB4PSIwIiB5PSIzODQiIGZvbnQtZmFtaWx5PSJDYXNjYWRpYSwgU2Vnb2UgVUkgRW1vamksIG1vbm9zcGFjZSIgZm9udC1zaXplPSIyMHB4IiBmaWxsPSIjMWUxZTFlIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHN0eWxlPSJ3aGl0ZS1zcGFjZTogcHJlOyIgZGlyZWN0aW9uPSJsdHIiIGRvbWluYW50LWJhc2VsaW5lPSJ0ZXh0LWJlZm9yZS1lZGdlIj4gIHJlc3VsdCAqPSA0PC90ZXh0Pjx0ZXh0IHg9IjAiIHk9IjQwOCIgZm9udC1mYW1pbHk9IkNhc2NhZGlhLCBTZWdvZSBVSSBFbW9qaSwgbW9ub3NwYWNlIiBmb250LXNpemU9IjIwcHgiIGZpbGw9IiMxZTFlMWUiIHRleHQtYW5jaG9yPSJzdGFydCIgc3R5bGU9IndoaXRlLXNwYWNlOiBwcmU7IiBkaXJlY3Rpb249Imx0ciIgZG9taW5hbnQtYmFzZWxpbmU9InRleHQtYmVmb3JlLWVkZ2UiPiAgNC0tPC90ZXh0Pjx0ZXh0IHg9IjAiIHk9IjQzMiIgZm9udC1mYW1pbHk9IkNhc2NhZGlhLCBTZWdvZSBVSSBFbW9qaSwgbW9ub3NwYWNlIiBmb250LXNpemU9IjIwcHgiIGZpbGw9IiMxZTFlMWUiIHRleHQtYW5jaG9yPSJzdGFydCIgc3R5bGU9IndoaXRlLXNwYWNlOiBwcmU7IiBkaXJlY3Rpb249Imx0ciIgZG9taW5hbnQtYmFzZWxpbmU9InRleHQtYmVmb3JlLWVkZ2UiPn08L3RleHQ+PHRleHQgeD0iMCIgeT0iNDU2IiBmb250LWZhbWlseT0iQ2FzY2FkaWEsIFNlZ29lIFVJIEVtb2ppLCBtb25vc3BhY2UiIGZvbnQtc2l6ZT0iMjBweCIgZmlsbD0iIzFlMWUxZSIgdGV4dC1hbmNob3I9InN0YXJ0IiBzdHlsZT0id2hpdGUtc3BhY2U6IHByZTsiIGRpcmVjdGlvbj0ibHRyIiBkb21pbmFudC1iYXNlbGluZT0idGV4dC1iZWZvcmUtZWRnZSI+PC90ZXh0Pjx0ZXh0IHg9IjAiIHk9IjQ4MCIgZm9udC1mYW1pbHk9IkNhc2NhZGlhLCBTZWdvZSBVSSBFbW9qaSwgbW9ub3NwYWNlIiBmb250LXNpemU9IjIwcHgiIGZpbGw9IiMxZTFlMWUiIHRleHQtYW5jaG9yPSJzdGFydCIgc3R5bGU9IndoaXRlLXNwYWNlOiBwcmU7IiBkaXJlY3Rpb249Imx0ciIgZG9taW5hbnQtYmFzZWxpbmU9InRleHQtYmVmb3JlLWVkZ2UiPnJlc3VsdCA9IDEyMDwvdGV4dD48dGV4dCB4PSIwIiB5PSI1MDQiIGZvbnQtZmFtaWx5PSJDYXNjYWRpYSwgU2Vnb2UgVUkgRW1vamksIG1vbm9zcGFjZSIgZm9udC1zaXplPSIyMHB4IiBmaWxsPSIjMWUxZTFlIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHN0eWxlPSJ3aGl0ZS1zcGFjZTogcHJlOyIgZGlyZWN0aW9uPSJsdHIiIGRvbWluYW50LWJhc2VsaW5lPSJ0ZXh0LWJlZm9yZS1lZGdlIj53aGlsZSgzICZndDsgMSkgezwvdGV4dD48dGV4dCB4PSIwIiB5PSI1MjgiIGZvbnQtZmFtaWx5PSJDYXNjYWRpYSwgU2Vnb2UgVUkgRW1vamksIG1vbm9zcGFjZSIgZm9udC1zaXplPSIyMHB4IiBmaWxsPSIjMWUxZTFlIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHN0eWxlPSJ3aGl0ZS1zcGFjZTogcHJlOyIgZGlyZWN0aW9uPSJsdHIiIGRvbWluYW50LWJhc2VsaW5lPSJ0ZXh0LWJlZm9yZS1lZGdlIj4gIHJlc3VsdCAqPSAzPC90ZXh0Pjx0ZXh0IHg9IjAiIHk9IjU1MiIgZm9udC1mYW1pbHk9IkNhc2NhZGlhLCBTZWdvZSBVSSBFbW9qaSwgbW9ub3NwYWNlIiBmb250LXNpemU9IjIwcHgiIGZpbGw9IiMxZTFlMWUiIHRleHQtYW5jaG9yPSJzdGFydCIgc3R5bGU9IndoaXRlLXNwYWNlOiBwcmU7IiBkaXJlY3Rpb249Imx0ciIgZG9taW5hbnQtYmFzZWxpbmU9InRleHQtYmVmb3JlLWVkZ2UiPiAgMy0tPC90ZXh0Pjx0ZXh0IHg9IjAiIHk9IjU3NiIgZm9udC1mYW1pbHk9IkNhc2NhZGlhLCBTZWdvZSBVSSBFbW9qaSwgbW9ub3NwYWNlIiBmb250LXNpemU9IjIwcHgiIGZpbGw9IiMxZTFlMWUiIHRleHQtYW5jaG9yPSJzdGFydCIgc3R5bGU9IndoaXRlLXNwYWNlOiBwcmU7IiBkaXJlY3Rpb249Imx0ciIgZG9taW5hbnQtYmFzZWxpbmU9InRleHQtYmVmb3JlLWVkZ2UiPn08L3RleHQ+PHRleHQgeD0iMCIgeT0iNjAwIiBmb250LWZhbWlseT0iQ2FzY2FkaWEsIFNlZ29lIFVJIEVtb2ppLCBtb25vc3BhY2UiIGZvbnQtc2l6ZT0iMjBweCIgZmlsbD0iIzFlMWUxZSIgdGV4dC1hbmNob3I9InN0YXJ0IiBzdHlsZT0id2hpdGUtc3BhY2U6IHByZTsiIGRpcmVjdGlvbj0ibHRyIiBkb21pbmFudC1iYXNlbGluZT0idGV4dC1iZWZvcmUtZWRnZSI+PC90ZXh0Pjx0ZXh0IHg9IjAiIHk9IjYyNCIgZm9udC1mYW1pbHk9IkNhc2NhZGlhLCBTZWdvZSBVSSBFbW9qaSwgbW9ub3NwYWNlIiBmb250LXNpemU9IjIwcHgiIGZpbGw9IiMxZTFlMWUiIHRleHQtYW5jaG9yPSJzdGFydCIgc3R5bGU9IndoaXRlLXNwYWNlOiBwcmU7IiBkaXJlY3Rpb249Imx0ciIgZG9taW5hbnQtYmFzZWxpbmU9InRleHQtYmVmb3JlLWVkZ2UiPnJlc3VsdCA9IDM2MDwvdGV4dD48dGV4dCB4PSIwIiB5PSI2NDgiIGZvbnQtZmFtaWx5PSJDYXNjYWRpYSwgU2Vnb2UgVUkgRW1vamksIG1vbm9zcGFjZSIgZm9udC1zaXplPSIyMHB4IiBmaWxsPSIjMWUxZTFlIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHN0eWxlPSJ3aGl0ZS1zcGFjZTogcHJlOyIgZGlyZWN0aW9uPSJsdHIiIGRvbWluYW50LWJhc2VsaW5lPSJ0ZXh0LWJlZm9yZS1lZGdlIj53aGlsZSgyICZndDsgMSkgezwvdGV4dD48dGV4dCB4PSIwIiB5PSI2NzIiIGZvbnQtZmFtaWx5PSJDYXNjYWRpYSwgU2Vnb2UgVUkgRW1vamksIG1vbm9zcGFjZSIgZm9udC1zaXplPSIyMHB4IiBmaWxsPSIjMWUxZTFlIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHN0eWxlPSJ3aGl0ZS1zcGFjZTogcHJlOyIgZGlyZWN0aW9uPSJsdHIiIGRvbWluYW50LWJhc2VsaW5lPSJ0ZXh0LWJlZm9yZS1lZGdlIj4gIHJlc3VsdCAqPSAyPC90ZXh0Pjx0ZXh0IHg9IjAiIHk9IjY5NiIgZm9udC1mYW1pbHk9IkNhc2NhZGlhLCBTZWdvZSBVSSBFbW9qaSwgbW9ub3NwYWNlIiBmb250LXNpemU9IjIwcHgiIGZpbGw9IiMxZTFlMWUiIHRleHQtYW5jaG9yPSJzdGFydCIgc3R5bGU9IndoaXRlLXNwYWNlOiBwcmU7IiBkaXJlY3Rpb249Imx0ciIgZG9taW5hbnQtYmFzZWxpbmU9InRleHQtYmVmb3JlLWVkZ2UiPiAgMi0tPC90ZXh0Pjx0ZXh0IHg9IjAiIHk9IjcyMCIgZm9udC1mYW1pbHk9IkNhc2NhZGlhLCBTZWdvZSBVSSBFbW9qaSwgbW9ub3NwYWNlIiBmb250LXNpemU9IjIwcHgiIGZpbGw9IiMxZTFlMWUiIHRleHQtYW5jaG9yPSJzdGFydCIgc3R5bGU9IndoaXRlLXNwYWNlOiBwcmU7IiBkaXJlY3Rpb249Imx0ciIgZG9taW5hbnQtYmFzZWxpbmU9InRleHQtYmVmb3JlLWVkZ2UiPn08L3RleHQ+PHRleHQgeD0iMCIgeT0iNzQ0IiBmb250LWZhbWlseT0iQ2FzY2FkaWEsIFNlZ29lIFVJIEVtb2ppLCBtb25vc3BhY2UiIGZvbnQtc2l6ZT0iMjBweCIgZmlsbD0iIzFlMWUxZSIgdGV4dC1hbmNob3I9InN0YXJ0IiBzdHlsZT0id2hpdGUtc3BhY2U6IHByZTsiIGRpcmVjdGlvbj0ibHRyIiBkb21pbmFudC1iYXNlbGluZT0idGV4dC1iZWZvcmUtZWRnZSI+PC90ZXh0Pjx0ZXh0IHg9IjAiIHk9Ijc2OCIgZm9udC1mYW1pbHk9IkNhc2NhZGlhLCBTZWdvZSBVSSBFbW9qaSwgbW9ub3NwYWNlIiBmb250LXNpemU9IjIwcHgiIGZpbGw9IiMxZTFlMWUiIHRleHQtYW5jaG9yPSJzdGFydCIgc3R5bGU9IndoaXRlLXNwYWNlOiBwcmU7IiBkaXJlY3Rpb249Imx0ciIgZG9taW5hbnQtYmFzZWxpbmU9InRleHQtYmVmb3JlLWVkZ2UiPnJlc3VsdCA9IDcyMDwvdGV4dD48L2c+PGcgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMC42MzI4MTI1IDEwKSByb3RhdGUoMCA5MS44Mzc4OTA2MjUgNDA5LjIzODI4MTI1KSI+PHBhdGggZD0iTTAgMCBDNDguNSAwLCA5NyAwLCAxODMuNjggMCBNMCAwIEMzOC4xIDAsIDc2LjIxIDAsIDE4My42OCAwIE0xODMuNjggMCBDMTgzLjY4IDMyMi4zOSwgMTgzLjY4IDY0NC43OCwgMTgzLjY4IDgxOC40OCBNMTgzLjY4IDAgQzE4My42OCAyMDkuMTIsIDE4My42OCA0MTguMjQsIDE4My42OCA4MTguNDggTTE4My42OCA4MTguNDggQzEzNi42NSA4MTguNDgsIDg5LjYzIDgxOC40OCwgMCA4MTguNDggTTE4My42OCA4MTguNDggQzEzOS4yIDgxOC40OCwgOTQuNzIgODE4LjQ4LCAwIDgxOC40OCBNMCA4MTguNDggQzAgNTIwLjM2LCAwIDIyMi4yNSwgMCAwIE0wIDgxOC40OCBDMCA1NTIuOTUsIDAgMjg3LjQxLCAwIDAiIHN0cm9rZT0iIzFlMWUxZSIgc3Ryb2tlLXdpZHRoPSIyIiBmaWxsPSJub25lIj48L3BhdGg+PC9nPjxnIHN0cm9rZS1saW5lY2FwPSJyb3VuZCI+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTAuNDI1NzgxMjUgNTkuMjUpIHJvdGF0ZSgwIDkxLjE1NjI1IC0wLjcxODc1KSI+PHBhdGggZD0iTTAgMCBDNzIuMTIgLTAuNTcsIDE0NC4yNCAtMS4xNCwgMTgyLjMxIC0xLjQ0IE0wIDAgQzcxLjY5IC0wLjU3LCAxNDMuMzkgLTEuMTMsIDE4Mi4zMSAtMS40NCIgc3Ryb2tlPSIjMWUxZTFlIiBzdHJva2Utd2lkdGg9IjIiIGZpbGw9Im5vbmUiPjwvcGF0aD48L2c+PC9nPjxtYXNrPjwvbWFzaz48ZyBzdHJva2UtbGluZWNhcD0icm91bmQiPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDEyLjIzMDQ2ODc1IDIwMi4yNjk1MzEyNSkgcm90YXRlKDAgOTEuMTU2MjUgLTAuNzE4NzUpIj48cGF0aCBkPSJNMCAwIEMzNi41OSAtMC4yOSwgNzMuMTkgLTAuNTgsIDE4Mi4zMSAtMS40NCIgc3Ryb2tlPSIjMWUxZTFlIiBzdHJva2Utd2lkdGg9IjIuNSIgZmlsbD0ibm9uZSIgc3Ryb2tlLWRhc2hhcnJheT0iOCAxMCI+PC9wYXRoPjwvZz48L2c+PG1hc2s+PC9tYXNrPjxnIHN0cm9rZS1saW5lY2FwPSJyb3VuZCI+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTAuNjI1IDM0Ny44NzEwOTM3NSkgcm90YXRlKDAgOTEuMTU2MjUgLTAuNzE4NzUpIj48cGF0aCBkPSJNMCAwIEM1MS4zMyAtMC40LCAxMDIuNjYgLTAuODEsIDE4Mi4zMSAtMS40NCIgc3Ryb2tlPSIjMWUxZTFlIiBzdHJva2Utd2lkdGg9IjIuNSIgZmlsbD0ibm9uZSIgc3Ryb2tlLWRhc2hhcnJheT0iOCAxMCI+PC9wYXRoPjwvZz48L2c+PG1hc2s+PC9tYXNrPjxnIHN0cm9rZS1saW5lY2FwPSJyb3VuZCI+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTEuMDE5NTMxMjUgNDkyLjI4MTI1KSByb3RhdGUoMCA5MS4xNTYyNSAtMC43MTg3NSkiPjxwYXRoIGQ9Ik0wIDAgQzU3LjQ0IC0wLjQ1LCAxMTQuODggLTAuOTEsIDE4Mi4zMSAtMS40NCIgc3Ryb2tlPSIjMWUxZTFlIiBzdHJva2Utd2lkdGg9IjIuNSIgZmlsbD0ibm9uZSIgc3Ryb2tlLWRhc2hhcnJheT0iOCAxMCI+PC9wYXRoPjwvZz48L2c+PG1hc2s+PC9tYXNrPjxnIHN0cm9rZS1saW5lY2FwPSJyb3VuZCI+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTAgNjM4LjczNDM3NSkgcm90YXRlKDAgOTEuMTU2MjUgLTAuNzE4NzUpIj48cGF0aCBkPSJNMCAwIEM2OS43NyAtMC41NSwgMTM5LjU0IC0xLjEsIDE4Mi4zMSAtMS40NCIgc3Ryb2tlPSIjMWUxZTFlIiBzdHJva2Utd2lkdGg9IjIuNSIgZmlsbD0ibm9uZSIgc3Ryb2tlLWRhc2hhcnJheT0iOCAxMCI+PC9wYXRoPjwvZz48L2c+PG1hc2s+PC9tYXNrPjxnIHN0cm9rZS1saW5lY2FwPSJyb3VuZCI+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTAuMzc1IDc3OS4wODU5Mzc1KSByb3RhdGUoMCA5MS43MTY3OTY4NzUgLTAuMTExMzI4MTI1KSI+PHBhdGggZD0iTTAgMCBDNjAuODcgLTAuMDcsIDEyMS43NSAtMC4xNSwgMTgzLjQzIC0wLjIyIE0wIDAgQzQyLjk4IC0wLjA1LCA4NS45NyAtMC4xLCAxODMuNDMgLTAuMjIiIHN0cm9rZT0iIzFlMWUxZSIgc3Ryb2tlLXdpZHRoPSIyIiBmaWxsPSJub25lIj48L3BhdGg+PC9nPjwvZz48bWFzaz48L21hc2s+PGcgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIj48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyNTMuODUxNTYyNSAxOC40NjA5Mzc1KSByb3RhdGUoMCAtMjEuNDg0Mzc1IDM5Mi4yMzgyODEyNSkiPjxwYXRoIGQ9Ik0wIDAgQzAuNTEgMTkzLjgzLCAxLjAyIDM4Ny42NSwgMi4wNSA3ODMuODYgTTAgMCBDMC43NyAyOTUuMzgsIDEuNTUgNTkwLjc2LCAyLjA1IDc4My44NiBNMi4wNSA3ODMuODYgQy0xMy4zNSA3ODQuMDYsIC0yOC43NSA3ODQuMjYsIC00NS4wMiA3ODQuNDggTTIuMDUgNzgzLjg2IEMtOC4xNCA3ODMuOTksIC0xOC4zMyA3ODQuMTIsIC00NS4wMiA3ODQuNDgiIHN0cm9rZT0iI2UwMzEzMSIgc3Ryb2tlLXdpZHRoPSIyIiBmaWxsPSJub25lIj48L3BhdGg+PC9nPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDI1My44NTE1NjI1IDE4LjQ2MDkzNzUpIHJvdGF0ZSgwIC0yMS40ODQzNzUgMzkyLjIzODI4MTI1KSI+PHBhdGggZD0iTS00NS4wMiA3ODQuNDggTC0zMS41MSA3NzcuOTYgTC0zMS4zNSA3OTAuNjQgTC00NS4wMiA3ODQuNDgiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIwIiBmaWxsPSIjZTAzMTMxIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjwvcGF0aD48cGF0aCBkPSJNLTQ1LjAyIDc4NC40OCBDLTQxLjY4IDc4Mi44NiwgLTM4LjM0IDc4MS4yNSwgLTMxLjUxIDc3Ny45NiBNLTQ1LjAyIDc4NC40OCBDLTM5LjkzIDc4Mi4wMiwgLTM0Ljg0IDc3OS41NiwgLTMxLjUxIDc3Ny45NiBNLTMxLjUxIDc3Ny45NiBDLTMxLjQ2IDc4Mi4xMSwgLTMxLjQgNzg2LjI1LCAtMzEuMzUgNzkwLjY0IE0tMzEuNTEgNzc3Ljk2IEMtMzEuNDggNzgwLjcsIC0zMS40NCA3ODMuNDUsIC0zMS4zNSA3OTAuNjQgTS0zMS4zNSA3OTAuNjQgQy0zNC43IDc4OS4xMywgLTM4LjA1IDc4Ny42MiwgLTQ1LjAyIDc4NC40OCBNLTMxLjM1IDc5MC42NCBDLTM1LjUyIDc4OC43NiwgLTM5LjY5IDc4Ni44OCwgLTQ1LjAyIDc4NC40OCBNLTQ1LjAyIDc4NC40OCBDLTQ1LjAyIDc4NC40OCwgLTQ1LjAyIDc4NC40OCwgLTQ1LjAyIDc4NC40OCBNLTQ1LjAyIDc4NC40OCBDLTQ1LjAyIDc4NC40OCwgLTQ1LjAyIDc4NC40OCwgLTQ1LjAyIDc4NC40OCIgc3Ryb2tlPSIjZTAzMTMxIiBzdHJva2Utd2lkdGg9IjIiIGZpbGw9Im5vbmUiPjwvcGF0aD48L2c+PC9nPjxtYXNrPjwvbWFzaz48L3N2Zz4=" />

Now, compare it with the substitution model for calculating the factorial of 6 using the recursive function:
<SVG64 content="PHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCAwIDUyMy4xMjUwODcxODU1MzM5IDMwOCIgc3R5bGU9Im1heC13aWR0aDogNTAwcHg7Ij4KICA8cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iNTIzLjEyNTA4NzE4NTUzMzkiIGhlaWdodD0iMzA4IiBmaWxsPSIjZmZmZmZmIj48L3JlY3Q+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTAgMTApIHJvdGF0ZSgwIDIzNC4zNzUgMTQ0KSI+PHRleHQgeD0iMCIgeT0iMCIgZm9udC1mYW1pbHk9IkNhc2NhZGlhLCBTZWdvZSBVSSBFbW9qaSxtb25vc3BhY2UiIGZvbnQtc2l6ZT0iMjBweCIgZmlsbD0iIzFlMWUxZSIgdGV4dC1hbmNob3I9InN0YXJ0IiBzdHlsZT0id2hpdGUtc3BhY2U6IHByZTsiIGRpcmVjdGlvbj0ibHRyIiBkb21pbmFudC1iYXNlbGluZT0idGV4dC1iZWZvcmUtZWRnZSI+ZmFjdG9yaWFsKDYpPC90ZXh0Pjx0ZXh0IHg9IjAiIHk9IjI0IiBmb250LWZhbWlseT0iQ2FzY2FkaWEsIFNlZ29lIFVJIEVtb2ppLG1vbm9zcGFjZSIgZm9udC1zaXplPSIyMHB4IiBmaWxsPSIjMWUxZTFlIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHN0eWxlPSJ3aGl0ZS1zcGFjZTogcHJlOyIgZGlyZWN0aW9uPSJsdHIiIGRvbWluYW50LWJhc2VsaW5lPSJ0ZXh0LWJlZm9yZS1lZGdlIj42ICogZmFjdG9yaWFsKDUpPC90ZXh0Pjx0ZXh0IHg9IjAiIHk9IjQ4IiBmb250LWZhbWlseT0iQ2FzY2FkaWEsIFNlZ29lIFVJIEVtb2ppLG1vbm9zcGFjZSIgZm9udC1zaXplPSIyMHB4IiBmaWxsPSIjMWUxZTFlIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHN0eWxlPSJ3aGl0ZS1zcGFjZTogcHJlOyIgZGlyZWN0aW9uPSJsdHIiIGRvbWluYW50LWJhc2VsaW5lPSJ0ZXh0LWJlZm9yZS1lZGdlIj42ICogKDUgKiBmYWN0b3JpYWwoNCkpPC90ZXh0Pjx0ZXh0IHg9IjAiIHk9IjcyIiBmb250LWZhbWlseT0iQ2FzY2FkaWEsIFNlZ29lIFVJIEVtb2ppLG1vbm9zcGFjZSIgZm9udC1zaXplPSIyMHB4IiBmaWxsPSIjMWUxZTFlIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHN0eWxlPSJ3aGl0ZS1zcGFjZTogcHJlOyIgZGlyZWN0aW9uPSJsdHIiIGRvbWluYW50LWJhc2VsaW5lPSJ0ZXh0LWJlZm9yZS1lZGdlIj42ICogKDUgKiAoNCAqIGZhY3RvcmlhbCgzKSkpPC90ZXh0Pjx0ZXh0IHg9IjAiIHk9Ijk2IiBmb250LWZhbWlseT0iQ2FzY2FkaWEsIFNlZ29lIFVJIEVtb2ppLG1vbm9zcGFjZSIgZm9udC1zaXplPSIyMHB4IiBmaWxsPSIjMWUxZTFlIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHN0eWxlPSJ3aGl0ZS1zcGFjZTogcHJlOyIgZGlyZWN0aW9uPSJsdHIiIGRvbWluYW50LWJhc2VsaW5lPSJ0ZXh0LWJlZm9yZS1lZGdlIj42ICogKDUgKiAoNCAqICgzICogZmFjdG9yaWFsKDIpKSkpPC90ZXh0Pjx0ZXh0IHg9IjAiIHk9IjEyMCIgZm9udC1mYW1pbHk9IkNhc2NhZGlhLCBTZWdvZSBVSSBFbW9qaSxtb25vc3BhY2UiIGZvbnQtc2l6ZT0iMjBweCIgZmlsbD0iIzFlMWUxZSIgdGV4dC1hbmNob3I9InN0YXJ0IiBzdHlsZT0id2hpdGUtc3BhY2U6IHByZTsiIGRpcmVjdGlvbj0ibHRyIiBkb21pbmFudC1iYXNlbGluZT0idGV4dC1iZWZvcmUtZWRnZSI+NiAqICg1ICogKDQgKiAoMyAqICgyICogZmFjdG9yaWFsKDEpKSkpKTwvdGV4dD48dGV4dCB4PSIwIiB5PSIxNDQiIGZvbnQtZmFtaWx5PSJDYXNjYWRpYSwgU2Vnb2UgVUkgRW1vamksbW9ub3NwYWNlIiBmb250LXNpemU9IjIwcHgiIGZpbGw9IiMxZTFlMWUiIHRleHQtYW5jaG9yPSJzdGFydCIgc3R5bGU9IndoaXRlLXNwYWNlOiBwcmU7IiBkaXJlY3Rpb249Imx0ciIgZG9taW5hbnQtYmFzZWxpbmU9InRleHQtYmVmb3JlLWVkZ2UiPjYgKiAoNSAqICg0ICogKDMgKiAoMiAqIDEpKSkpPC90ZXh0Pjx0ZXh0IHg9IjAiIHk9IjE2OCIgZm9udC1mYW1pbHk9IkNhc2NhZGlhLCBTZWdvZSBVSSBFbW9qaSxtb25vc3BhY2UiIGZvbnQtc2l6ZT0iMjBweCIgZmlsbD0iIzFlMWUxZSIgdGV4dC1hbmNob3I9InN0YXJ0IiBzdHlsZT0id2hpdGUtc3BhY2U6IHByZTsiIGRpcmVjdGlvbj0ibHRyIiBkb21pbmFudC1iYXNlbGluZT0idGV4dC1iZWZvcmUtZWRnZSI+NiAqICg1ICogKDQgKiAoMyAqIDIpKSk8L3RleHQ+PHRleHQgeD0iMCIgeT0iMTkyIiBmb250LWZhbWlseT0iQ2FzY2FkaWEsIFNlZ29lIFVJIEVtb2ppLG1vbm9zcGFjZSIgZm9udC1zaXplPSIyMHB4IiBmaWxsPSIjMWUxZTFlIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHN0eWxlPSJ3aGl0ZS1zcGFjZTogcHJlOyIgZGlyZWN0aW9uPSJsdHIiIGRvbWluYW50LWJhc2VsaW5lPSJ0ZXh0LWJlZm9yZS1lZGdlIj42ICogKDUgKiAoNCAqIDYpKTwvdGV4dD48dGV4dCB4PSIwIiB5PSIyMTYiIGZvbnQtZmFtaWx5PSJDYXNjYWRpYSwgU2Vnb2UgVUkgRW1vamksbW9ub3NwYWNlIiBmb250LXNpemU9IjIwcHgiIGZpbGw9IiMxZTFlMWUiIHRleHQtYW5jaG9yPSJzdGFydCIgc3R5bGU9IndoaXRlLXNwYWNlOiBwcmU7IiBkaXJlY3Rpb249Imx0ciIgZG9taW5hbnQtYmFzZWxpbmU9InRleHQtYmVmb3JlLWVkZ2UiPjYgKiAoNSAqIDI0KTwvdGV4dD48dGV4dCB4PSIwIiB5PSIyNDAiIGZvbnQtZmFtaWx5PSJDYXNjYWRpYSwgU2Vnb2UgVUkgRW1vamksbW9ub3NwYWNlIiBmb250LXNpemU9IjIwcHgiIGZpbGw9IiMxZTFlMWUiIHRleHQtYW5jaG9yPSJzdGFydCIgc3R5bGU9IndoaXRlLXNwYWNlOiBwcmU7IiBkaXJlY3Rpb249Imx0ciIgZG9taW5hbnQtYmFzZWxpbmU9InRleHQtYmVmb3JlLWVkZ2UiPjYgKiAxMjA8L3RleHQ+PHRleHQgeD0iMCIgeT0iMjY0IiBmb250LWZhbWlseT0iQ2FzY2FkaWEsIFNlZ29lIFVJIEVtb2ppLG1vbm9zcGFjZSIgZm9udC1zaXplPSIyMHB4IiBmaWxsPSIjMWUxZTFlIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHN0eWxlPSJ3aGl0ZS1zcGFjZTogcHJlOyIgZGlyZWN0aW9uPSJsdHIiIGRvbWluYW50LWJhc2VsaW5lPSJ0ZXh0LWJlZm9yZS1lZGdlIj43MjA8L3RleHQ+PC9nPjxnIHN0cm9rZS1saW5lY2FwPSJyb3VuZCI+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTUxLjk5MjE4NzUgMTYuNjgzNTkzNzUpIHJvdGF0ZSgwIDE0Mi4wNzYyMTU0Njc3NjcwNCAxMzMuNDkwMjM0Mzc1KSI+PHBhdGggZD0iTTAgMCBDNjAuMTMgMjAuOTMsIDM3My41OCA4MS4wNywgMzYwLjc1IDEyNS41NyBDMzQ3LjkyIDE3MC4wNiwgLTQuMDMgMjQzLjQxLCAtNzYuOTggMjY2Ljk4IE0wIDAgQzYwLjEzIDIwLjkzLCAzNzMuNTggODEuMDcsIDM2MC43NSAxMjUuNTcgQzM0Ny45MiAxNzAuMDYsIC00LjAzIDI0My40MSwgLTc2Ljk4IDI2Ni45OCIgc3Ryb2tlPSIjZTAzMTMxIiBzdHJva2Utd2lkdGg9IjIiIGZpbGw9Im5vbmUiPjwvcGF0aD48L2c+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTUxLjk5MjE4NzUgMTYuNjgzNTkzNzUpIHJvdGF0ZSgwIDE0Mi4wNzYyMTU0Njc3NjcwNCAxMzMuNDkwMjM0Mzc1KSI+PHBhdGggZD0iTS03Ni45OCAyNjYuOTggTC02NS40MyAyNTcuNDEgTC02Mi4yMiAyNjkuNjcgTC03Ni45OCAyNjYuOTgiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIwIiBmaWxsPSIjZTAzMTMxIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjwvcGF0aD48cGF0aCBkPSJNLTc2Ljk4IDI2Ni45OCBDLTc0LjEyIDI2NC42MSwgLTcxLjI3IDI2Mi4yNCwgLTY1LjQzIDI1Ny40MSBNLTc2Ljk4IDI2Ni45OCBDLTczLjk1IDI2NC40NywgLTcwLjkyIDI2MS45NiwgLTY1LjQzIDI1Ny40MSBNLTY1LjQzIDI1Ny40MSBDLTY0LjcgMjYwLjIsIC02My45NyAyNjMsIC02Mi4yMiAyNjkuNjcgTS02NS40MyAyNTcuNDEgQy02NC41OCAyNjAuNjcsIC02My43MyAyNjMuOTMsIC02Mi4yMiAyNjkuNjcgTS02Mi4yMiAyNjkuNjcgQy02Ny41NCAyNjguNywgLTcyLjg1IDI2Ny43MywgLTc2Ljk4IDI2Ni45OCBNLTYyLjIyIDI2OS42NyBDLTY3LjkzIDI2OC42MywgLTczLjYzIDI2Ny41OSwgLTc2Ljk4IDI2Ni45OCBNLTc2Ljk4IDI2Ni45OCBDLTc2Ljk4IDI2Ni45OCwgLTc2Ljk4IDI2Ni45OCwgLTc2Ljk4IDI2Ni45OCBNLTc2Ljk4IDI2Ni45OCBDLTc2Ljk4IDI2Ni45OCwgLTc2Ljk4IDI2Ni45OCwgLTc2Ljk4IDI2Ni45OCIgc3Ryb2tlPSIjZTAzMTMxIiBzdHJva2Utd2lkdGg9IjIiIGZpbGw9Im5vbmUiPjwvcGF0aD48L2c+PC9nPjxtYXNrPjwvbWFzaz48L3N2Zz4=" />

Note that, in the iterative function, the arrow shape is linear and we can see the state of each variable at each step. In addition, at each iteration of our loop, a calculation is performed and the variables stored in memory are updated. In the recursive function, the arrow shape is exponential and we cannot see the state of all variables in the first half of the processing. In addition, each time the function is executed, more memory needs to be used to store the resulting values of each execution.

But what does this mean? In order for JavaScript to calculate the factorial of 6 using the iterative function, the `while` condition is added to the stack, where its calculation is performed, the `result` variable is updated, and then the executed code block of the `while` is removed from the stack. This is done until the while condition is false, that is, until the value of `n` is less than or equal to 1.

In the recursive function, each call to the `factorial` function is added to the stack as many times as necessary until the if condition is false, that is, until the value of `n` is less than or equal to 1. This means that, to calculate the factorial of 6, the `factorial` function is added to the stack 6 times before being executed. And that's why, when we try to calculate the factorial of a large number (100,000, for example), we encounter the error `RangeError: Maximum call stack size exceeded`: there is not enough space in the stack to store all the calls to the `factorial` function.

## Introducing Tail Call Optimization

As defined by [Dr. Axel Rauschmayer](https://dr-axel.de/):

> [...] whenever the last thing a function does is call another function, then this last function does not need to return to its caller. As a consequence, no information needs to be stored on the call stack and the function call is more like a goto (a jump). This type of call is called a _tail call_; not increasing the stack is called tail call optimization (TCO).

Now, we have discovered that our factorial calculation function is not tail recursive. But how can we make it tail recursive? With the help of another function:

```javascript
const factorial = (n) => {
  return factorialHelper(n, 1)
}

const factorialHelper = (x, accumulator) => {
  if (x <= 1) {
    return accumulator
  }

  return factorialHelper(x - 1, x * accumulator)
}
```

Now, our function is tail recursive: the last thing it does is call a function (and not calculate an expression, as in the first implementation). Now, let's see the substitution model for calculating the factorial of 6 with our new `factorial` function:

<SVG64 content="PHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCAwIDMyMS4zMTY0MDYyNSAyMjguNDIxODc1IiBzdHlsZT0ibWF4LXdpZHRoOiAzMDBweDsiPgogIDxyZWN0IHg9IjAiIHk9IjAiIHdpZHRoPSIzMjEuMzE2NDA2MjUiIGhlaWdodD0iMjI4LjQyMTg3NSIgZmlsbD0iI2ZmZmZmZiI+PC9yZWN0PjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDEwIDI2LjQyMTg3NSkgcm90YXRlKDAgMTM0Ljc2NTYyNSA5NikiPjx0ZXh0IHg9IjAiIHk9IjAiIGZvbnQtZmFtaWx5PSJDYXNjYWRpYSwgU2Vnb2UgVUkgRW1vamksIG1vbm9zcGFjZSIgZm9udC1zaXplPSIyMHB4IiBmaWxsPSIjMWUxZTFlIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHN0eWxlPSJ3aGl0ZS1zcGFjZTogcHJlOyIgZGlyZWN0aW9uPSJsdHIiIGRvbWluYW50LWJhc2VsaW5lPSJ0ZXh0LWJlZm9yZS1lZGdlIj5mYWN0b3JpYWwoNik8L3RleHQ+PHRleHQgeD0iMCIgeT0iMjQiIGZvbnQtZmFtaWx5PSJDYXNjYWRpYSwgU2Vnb2UgVUkgRW1vamksIG1vbm9zcGFjZSIgZm9udC1zaXplPSIyMHB4IiBmaWxsPSIjMWUxZTFlIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHN0eWxlPSJ3aGl0ZS1zcGFjZTogcHJlOyIgZGlyZWN0aW9uPSJsdHIiIGRvbWluYW50LWJhc2VsaW5lPSJ0ZXh0LWJlZm9yZS1lZGdlIj5mYWN0b3JpYWxIZWxwZXIoNiwgMSk8L3RleHQ+PHRleHQgeD0iMCIgeT0iNDgiIGZvbnQtZmFtaWx5PSJDYXNjYWRpYSwgU2Vnb2UgVUkgRW1vamksIG1vbm9zcGFjZSIgZm9udC1zaXplPSIyMHB4IiBmaWxsPSIjMWUxZTFlIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHN0eWxlPSJ3aGl0ZS1zcGFjZTogcHJlOyIgZGlyZWN0aW9uPSJsdHIiIGRvbWluYW50LWJhc2VsaW5lPSJ0ZXh0LWJlZm9yZS1lZGdlIj5mYWN0b3JpYWxIZWxwZXIoNSwgNik8L3RleHQ+PHRleHQgeD0iMCIgeT0iNzIiIGZvbnQtZmFtaWx5PSJDYXNjYWRpYSwgU2Vnb2UgVUkgRW1vamksIG1vbm9zcGFjZSIgZm9udC1zaXplPSIyMHB4IiBmaWxsPSIjMWUxZTFlIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHN0eWxlPSJ3aGl0ZS1zcGFjZTogcHJlOyIgZGlyZWN0aW9uPSJsdHIiIGRvbWluYW50LWJhc2VsaW5lPSJ0ZXh0LWJlZm9yZS1lZGdlIj5mYWN0b3JpYWxIZWxwZXIoNCwgMzApPC90ZXh0Pjx0ZXh0IHg9IjAiIHk9Ijk2IiBmb250LWZhbWlseT0iQ2FzY2FkaWEsIFNlZ29lIFVJIEVtb2ppLCBtb25vc3BhY2UiIGZvbnQtc2l6ZT0iMjBweCIgZmlsbD0iIzFlMWUxZSIgdGV4dC1hbmNob3I9InN0YXJ0IiBzdHlsZT0id2hpdGUtc3BhY2U6IHByZTsiIGRpcmVjdGlvbj0ibHRyIiBkb21pbmFudC1iYXNlbGluZT0idGV4dC1iZWZvcmUtZWRnZSI+ZmFjdG9yaWFsSGVscGVyKDMsIDEyMCk8L3RleHQ+PHRleHQgeD0iMCIgeT0iMTIwIiBmb250LWZhbWlseT0iQ2FzY2FkaWEsIFNlZ29lIFVJIEVtb2ppLCBtb25vc3BhY2UiIGZvbnQtc2l6ZT0iMjBweCIgZmlsbD0iIzFlMWUxZSIgdGV4dC1hbmNob3I9InN0YXJ0IiBzdHlsZT0id2hpdGUtc3BhY2U6IHByZTsiIGRpcmVjdGlvbj0ibHRyIiBkb21pbmFudC1iYXNlbGluZT0idGV4dC1iZWZvcmUtZWRnZSI+ZmFjdG9yaWFsSGVscGVyKDIsIDM2MCk8L3RleHQ+PHRleHQgeD0iMCIgeT0iMTQ0IiBmb250LWZhbWlseT0iQ2FzY2FkaWEsIFNlZ29lIFVJIEVtb2ppLCBtb25vc3BhY2UiIGZvbnQtc2l6ZT0iMjBweCIgZmlsbD0iIzFlMWUxZSIgdGV4dC1hbmNob3I9InN0YXJ0IiBzdHlsZT0id2hpdGUtc3BhY2U6IHByZTsiIGRpcmVjdGlvbj0ibHRyIiBkb21pbmFudC1iYXNlbGluZT0idGV4dC1iZWZvcmUtZWRnZSI+ZmFjdG9yaWFsSGVscGVyKDEsIDcyMCk8L3RleHQ+PHRleHQgeD0iMCIgeT0iMTY4IiBmb250LWZhbWlseT0iQ2FzY2FkaWEsIFNlZ29lIFVJIEVtb2ppLCBtb25vc3BhY2UiIGZvbnQtc2l6ZT0iMjBweCIgZmlsbD0iIzFlMWUxZSIgdGV4dC1hbmNob3I9InN0YXJ0IiBzdHlsZT0id2hpdGUtc3BhY2U6IHByZTsiIGRpcmVjdGlvbj0ibHRyIiBkb21pbmFudC1iYXNlbGluZT0idGV4dC1iZWZvcmUtZWRnZSI+NzIwPC90ZXh0PjwvZz48ZyBzdHJva2UtbGluZWNhcD0icm91bmQiPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDMxOS45MTAxNTYyNSAxMCkgcm90YXRlKDAgLTI0LjQxMDE1NjI1IDk5LjY2NDA2MjUpIj48cGF0aCBkPSJNLTguNTkgMCBDLTguNzcgNzcuNzUsIC04Ljk1IDE1NS41MSwgLTkuMDUgMTk5LjMzIE0tOC41OSAwIEMtOC43MiA1Ny4xMSwgLTguODYgMTE0LjIyLCAtOS4wNSAxOTkuMzMgTS05LjA1IDE5OS4zMyBDLTE3LjI0IDE5OS4yMiwgLTI1LjQ0IDE5OS4xMSwgLTQwLjIzIDE5OC45MSBNLTkuMDUgMTk5LjMzIEMtMjAuOTYgMTk5LjE3LCAtMzIuODcgMTk5LjAxLCAtNDAuMjMgMTk4LjkxIiBzdHJva2U9IiNlMDMxMzEiIHN0cm9rZS13aWR0aD0iMiIgZmlsbD0ibm9uZSI+PC9wYXRoPjwvZz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgzMTkuOTEwMTU2MjUgMTApIHJvdGF0ZSgwIC0yNC40MTAxNTYyNSA5OS42NjQwNjI1KSI+PHBhdGggZD0iTS00MC4yMyAxOTguOTEgTC0yNi41NSAxOTIuNzUgTC0yNi43MiAyMDUuNDMgTC00MC4yMyAxOTguOTEiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIwIiBmaWxsPSIjZTAzMTMxIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjwvcGF0aD48cGF0aCBkPSJNLTQwLjIzIDE5OC45MSBDLTM0Ljg5IDE5Ni41MSwgLTI5LjU2IDE5NC4xMSwgLTI2LjU1IDE5Mi43NSBNLTQwLjIzIDE5OC45MSBDLTM2LjMxIDE5Ny4xNSwgLTMyLjM5IDE5NS4zOCwgLTI2LjU1IDE5Mi43NSBNLTI2LjU1IDE5Mi43NSBDLTI2LjU5IDE5Ni4wOSwgLTI2LjY0IDE5OS40MiwgLTI2LjcyIDIwNS40MyBNLTI2LjU1IDE5Mi43NSBDLTI2LjYxIDE5Ny42LCAtMjYuNjggMjAyLjQ0LCAtMjYuNzIgMjA1LjQzIE0tMjYuNzIgMjA1LjQzIEMtMjkuNSAyMDQuMDksIC0zMi4yNyAyMDIuNzUsIC00MC4yMyAxOTguOTEgTS0yNi43MiAyMDUuNDMgQy0zMC4yNyAyMDMuNzIsIC0zMy44MSAyMDIuMDEsIC00MC4yMyAxOTguOTEgTS00MC4yMyAxOTguOTEgQy00MC4yMyAxOTguOTEsIC00MC4yMyAxOTguOTEsIC00MC4yMyAxOTguOTEgTS00MC4yMyAxOTguOTEgQy00MC4yMyAxOTguOTEsIC00MC4yMyAxOTguOTEsIC00MC4yMyAxOTguOTEiIHN0cm9rZT0iI2UwMzEzMSIgc3Ryb2tlLXdpZHRoPSIyIiBmaWxsPSJub25lIj48L3BhdGg+PC9nPjwvZz48bWFzaz48L21hc2s+PC9zdmc+" />

[The performance is superior](https://jsben.ch/vOf9P) to our first implementation, although it still doesn't beat the performance of the iterative function. However, we still encounter the error `RangeError: Maximum call stack size exceeded`. But why does this happen? Because, despite our function being tail recursive, current versions of Node.js and browsers ([with the exception of Safari](https://webkit.org/blog/6240/ecmascript-6-proper-tail-calls-in-webkit/)) do not implement Tail Call Optimization (despite its inclusion in the [EcmaScript](https://262.ecma-international.org/6.0/#sec-tail-position-calls) specification since 2015).

But how will we solve this problem? With the help of another function, of course! For that, we will rely on the [Trampoline](https://en.wikipedia.org/wiki/Trampoline_(computing)) pattern:

```javascript
const trampoline = (fn) => {
  while (typeof fn === 'function') {
    fn = fn()
  }

  return result
}
```

Our trampoline function consists of a loop that invokes a function that wraps another function (what we call a [thunk](https://en.wikipedia.org/wiki/Thunk)) until there are no more functions to execute. Let's see how the implementation of our factorial function would look like with the Trampoline pattern:

```javascript
const trampoline = (fn) => {
  while (typeof fn === 'function') {
    fn = fn()
  }

  return fn
}

const factorialHelper = (x, accumulator) => {
  if (x <= 1) {
    return accumulator
  }

  // Now, a function returns another function
  return () => factorialHelper(x - 1, x * accumulator)
}

const factorial = (n) => {
  return trampoline(factorialHelper(n, 1))
}
```

And now, we can call our factorial function with a large number, without encountering the error `RangeError: Maximum call stack size exceeded`. Of course, depending on the factorial we want to calculate, we will encounter an Infinity, as it is a very large number (a number greater than Number.MAX_SAFE_INTEGER: 253 - <sup>1</sup>). In this case, we can use [BigInt](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/BigInt):

```javascript
const trampoline = (fn) => {
  while (typeof fn === 'function') {
    fn = fn()
  }

  return fn
}

const factorialHelper = (x, accumulator) => {
  if (x <= 1) {
    return accumulator
  }

  return () => factorialHelper(x - 1n, x * accumulator)
}

const factorial = (n) => {
  // Converting values to BigInt
  //-------------------------------\/----------\/
  return trampoline(factorialHelper(BigInt(n), 1n))
}
```

## Typing our function

And finally, let's add the necessary types to our factorial function:

```typescript
type Thunk = bigint | (() => Thunk)

const trampoline = (fn: Thunk) => {
  while (typeof fn === 'function') {
    fn = fn()
  }

  return fn
}

const factorialHelper = (x: bigint, accumulator: bigint): Thunk => {
  if (x <= 1) {
    return accumulator
  }

  return () => factorialHelper(x - 1n, x * accumulator)
}

const factorial = (n: number) => {
  return trampoline(factorialHelper(BigInt(n), 1n))
}
```

## References
- [What happened to proper tail calls in JavaScript?](https://www.mgmarlow.com/words/2021-03-27-proper-tail-calls-js/)
- [Tail Call Optmization](https://exploringjs.com/es6/ch_tail-calls.html)
- [Limites da recursão em JavaScript, TCO e o pattern Trampoline](http://cangaceirojavascript.com.br/limites-recursao-javascript-tco-e-pattern-trampoline/)
- [What is an Activation object in JavaScript?](https://softwareengineering.stackexchange.com/a/189973/383960)
- [Factorial](https://mathworld.wolfram.com/Factorial.html)
- [Tail Recursion Explained - Computerphile](https://www.youtube.com/watch?v=_JtPhF8MshA)
- [Tail Call Optimization: The Musical!!](https://www.youtube.com/watch?v=-PX0BV9hGZY)

